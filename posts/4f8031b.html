<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境 | Sora33</title><meta name="author" content="Sora33"><meta name="copyright" content="Sora33"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言minikube 可以做到在本地部署 kubernetes (也叫 K8s，后面会用 K8s 指代 kubernetes) 环境、以单节点集群环境运行，非常方便个人测试和学习。个人也打算使用 minikube 来当作练手，在差不多搞清楚 K8s 的运作原理以及各种配置后，再上多台服务器搭建的真正的 K8s 环境。所以希望本文可以帮助更多人以更轻松的方式学习，并初步了解 K8s 究竟是什么东西。">
<meta property="og:type" content="article">
<meta property="og:title" content="【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境">
<meta property="og:url" content="http://33sora.com/posts/4f8031b.html">
<meta property="og:site_name" content="Sora33">
<meta property="og:description" content="前言minikube 可以做到在本地部署 kubernetes (也叫 K8s，后面会用 K8s 指代 kubernetes) 环境、以单节点集群环境运行，非常方便个人测试和学习。个人也打算使用 minikube 来当作练手，在差不多搞清楚 K8s 的运作原理以及各种配置后，再上多台服务器搭建的真正的 K8s 环境。所以希望本文可以帮助更多人以更轻松的方式学习，并初步了解 K8s 究竟是什么东西。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-6dpjm6_1920x1080.png">
<meta property="article:published_time" content="2023-12-04T07:43:32.000Z">
<meta property="article:modified_time" content="2024-04-01T07:27:41.392Z">
<meta property="article:author" content="Sora33">
<meta property="article:tag" content="K8s">
<meta property="article:tag" content="kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-6dpjm6_1920x1080.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://33sora.com/posts/4f8031b.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 8 || hour >= 19
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"1QY6GKFJYT","apiKey":"ff7af72210f9015cb3c5205c3a3824e2","indexName":"dev_home","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/rightMenu.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="pokeball-loading"><div class="pokeball" id="normal"></div><div class="pokeball" id="great"></div><div class="pokeball" id="ultra"></div><div class="pokeball" id="master"></div><div class="pokeball" id="safari"></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = 'auto'
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0817/wallhaven-g7mpj7_1920x1080.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-wheelchair-alt"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-6dpjm6_1920x1080.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" alt="Logo"><span class="site-name">Sora33</span></a><a class="nav-page-title" href="/"><span class="site-name">【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-wheelchair-alt"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-12-04T07:43:32.000Z" title="发表于 2023-12-04 15:43:32">2023-12-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:300,&quot;messagePrev&quot;:&quot;距离最后更新已经过了&quot;,&quot;messageNext&quot;:&quot;天，文章内容可能已过时，如果有问题，欢迎留言反馈&quot;,&quot;postUpdate&quot;:&quot;2024-04-01 15:27:41&quot;}" hidden></div><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>minikube 可以做到在本地部署 kubernetes (也叫 K8s，后面会用 K8s 指代 kubernetes) 环境、以单节点集群环境运行，非常方便个人测试和学习。个人也打算使用 minikube 来当作练手，在差不多搞清楚 K8s 的运作原理以及各种配置后，再上多台服务器搭建的真正的 K8s 环境。所以希望本文可以帮助更多人以更轻松的方式学习，并初步了解 K8s 究竟是什么东西。</p>
<p><a href="https://33sora.com/posts/309ad6ee.html">多台服务器的 Kubernetes 搭建</a></p>
<h2 id="minikube"><a href="#minikube" class="headerlink" title="minikube"></a>minikube</h2><p>这里先放上源代码，以及 K8s 的官网</p>
<p><a target="_blank" rel="noopener" href="https://minikube.sigs.k8s.io/docs/start/">minikube</a>				<a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube">minikube(github)</a>				<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/home/">kubenates</a></p>
<p>正如前面所说，minikube 可以在本地计算机上运行单节点 Kubernetes 集群的工具。易于安装和使用，那么我们首先需要在本地安装 minikube</p>
<h2 id="安装minikube"><a href="#安装minikube" class="headerlink" title="安装minikube"></a>安装 minikube</h2><p><strong>PS：请先安装好 docker 再继续下面的步骤，因为 minikube 需要依赖于虚拟化软件来创建和管理虚拟机；本人只有 mac 环境是自己走了一遍，windows 与 linux 仅仅是通过官网给的方法得出的，如果有问题可以联系我～</strong></p>
<blockquote>
<p>如果下面执行 minikuber start 发生网络错误，使用阿里云镜像启动⬇️</p>
<p>minikube start –image-mirror-country=’cn’</p>
</blockquote>
<p>另外安装 kubectl 命令行工具，可以直接通过命令行来与 Kubernetes 进行交互（下面会包含安装方法）</p>
<p>也可以直接看官网的各平台安装方法：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/tasks/tools/">https://kubernetes.io/zh-cn/docs/tasks/tools/</a></p>
<h3 id="mac（使用homebrew）"><a href="#mac（使用homebrew）" class="headerlink" title="mac（使用homebrew）"></a>mac（使用 homebrew）</h3><p>之前 mac 那期我有说如何安装 homebrew，如果没有安装 homebrew 的小伙伴可以点链接空降过去	<a href="https://33sora.com/posts/48c4f338.html">一台 mac 的开发环境配置</a></p>
<p>mac 的 kubectl 安装方法：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install kubernetes-cli</span><br></pre></td></tr></tbody></table></figure>

<p>继续安装 minikube 并启动</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装minikube</span></span><br><span class="line">brew install minikube</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动minikube</span></span><br><span class="line">minikube start</span><br></pre></td></tr></tbody></table></figure>

<p>展示图下即成功。注意不要前加前缀 sudo 启动，会失败。另外，第一次启动应该会告诉你权限问题，问题很简单，去看下对应的文件夹地址，赋值即可。我这里忘截图了，不过位置在 /users/ 用户名 /.minikube 下。进入用户目录内，使用 <strong>sudo chmod -R 777 .minikube</strong> 给该文件夹权限即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312041101207.png" alt="image-20231204110131506"></p>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>windows 的 kubectl 安装方法：</p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-windows/">kubelet-windows</a>	进入链接，下载下图的 exe 程序安装即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312041627218.png" alt="image-20231204162221375"></p>
<p>下面是 minikube：进入 <a target="_blank" rel="noopener" href="https://minikube.sigs.k8s.io/docs/start/">minikube-windows</a>	链接内，选择好对应的版本，下载 exe 程序安装即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312041627553.png" alt="image-20231204162348817"></p>
<p>安装完成后在 cmd 使用 <strong>minikube start</strong> 启动 minikube</p>
<h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p>linux 的 kubectl 安装方法：</p>
<p>首先是下载最新的发行版：</p>
<blockquote>
<p>x86-64:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO "https://dl.K8s.io/release/$(curl -L -s https://dl.K8s.io/release/stable.txt)/bin/linux/amd64/kubectl"</span><br></pre></td></tr></tbody></table></figure>

<p>ARM64:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO "https://dl.K8s.io/release/$(curl -L -s https://dl.K8s.io/release/stable.txt)/bin/linux/arm64/kubectl"</span><br></pre></td></tr></tbody></table></figure>


</blockquote>
<p>之后安装到对应路径，这里默认是 /usr/local/bin/kubectl</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span><br></pre></td></tr></tbody></table></figure>

<p>使用 <strong>minikube start</strong> 启动 minikube，如果出现权限等问题，可以看下 mac 的最后一步，给对应的文件夹赋值权限即可。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过dashboard来开启控制台（注意单独开一个进程来开启控制台，如果ctrl+c的话控制台服务也会停止）</span></span><br><span class="line">minikube dashboard</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止本地集群：</span></span><br><span class="line">minikube stop</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除本地集群：</span></span><br><span class="line">minikube delete</span><br></pre></td></tr></tbody></table></figure>

<h2 id="K8s概念介绍"><a href="#K8s概念介绍" class="headerlink" title="K8s概念介绍"></a>K8s 概念介绍</h2><p>这里笼统的我就不陈述了，官方写的肯定比我好得多 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/overview/">K8s 官方文档</a>	这里我就以大白话的方式简单介绍几个重要的组件以及它们之间的关系，下面是官方的 K8s 架构图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312050923942.png" alt="image-20231205092349909"></p>
<p>K8s 集群是由多个 master 节点和多个 node 节点组成，master 负责整个集群的控制和管理，包括调度、监控、集群状态维护，而 node 节点则运行容器化的应用；本文的 minikube 包括一个 master 节点和一个 node 节点</p>
<h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p><strong>Kubernetes 中最基本的调度和管理单元，也是最重要的一个概念</strong>，每个 node 节点可以有多个 Pod，一个 Pod 包含一个或多个容器，并且 Pod 内的容器共享相同的网络命名空间、存储卷、IP 地址和端口空间。</p>
<h3 id="depolyment"><a href="#depolyment" class="headerlink" title="depolyment"></a>depolyment</h3><p>层级比 Pod 大一级，用来管理 Pod，确保指定 Pod 的数量副本在集群中运行，如果有一个 Pod 挂掉了，那么会自动重新创建一个新的 Pod 来保证集群内的 Pod 数量。</p>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>我们知道 Pod 是一个或多个的，如果 Pod 被销毁了就会重新创建，这就导致 Pod 的 IP 频繁变动，为了提供一个稳定的服务，Service 就是做这个的，serivce 定义了一种访问 Pod 的方式，提供一个稳定的网络端点以访问 Pod，将多个 Pod 进行封装，提供了集群内部的服务发现和负载均衡。我们只需要访问 Service 暴露给我们的地址就可以</p>
<h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><p>ingress 比较特殊，它是 K8s 的一个 API 对象，提供了一个从外部网络访问到 Service 的入口。也就是说管理外部访问集群的路由。并且可以根据不同的 URL，将不同的请求转发到到对应的 Service。和 Service 的区别有以下几点：1.Service 是集群的内部抽象，直接由 K8s 实现，而 ingress 则需要安装 Ingress 控制器引入；2.Service 主要作用于集群内部、ingress 作用于外部；3.Service 适用于 TCP 和 UDP 流量，而 ingress 则适用于 Http 和 Https。</p>
<p><strong>对于 Service 和 Ingress 可以这样理解：</strong>因为 Pod 的 IP 可能会发生变化，Service 就为这些动态 Pod 提供了一个固定的访问点，但是，当我们有许多这样的服务时，ingress 就派上了用场，通过判断请求前缀等信息，将对应请求转发到具体 Service 里</p>
<h3 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h3><p>命名空间，用来隔离应用和服务。使用命名空间可以方便管理</p>
<p>现在配合上面的概念进行下面的实践，会更方便理解</p>
<h2 id="基于nginx进行演示"><a href="#基于nginx进行演示" class="headerlink" title="基于nginx进行演示"></a>基于 nginx 进行演示</h2><p>PS：K8s 在创建资源时命名遵循 DNS 标签规范明明，不可以包含大写字符！！！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202403281448325.png" alt="image-20240328144821229"></p>
<h3 id="命名空间的创建"><a href="#命名空间的创建" class="headerlink" title="命名空间的创建"></a>命名空间的创建</h3><ol>
<li>首先我们需要创建一个新的命名空间，命名为 nginx，操作如下：</li>
</ol>
<blockquote>
<p>appVersion：声明版本，这个无需特别在意</p>
<p>kind：资源类型，这里声明为 namespace，表示目标是命名空间</p>
<p>metadata：描述创建对象的元信息，这里对命名空间标注上 name 以及标签</p>
</blockquote>
<p>创建一个 yaml 的文件（<strong>文件名都是可以自定义的，这里以 nginx-namespace.yaml 举例，后面自行替换文件名即可</strong>），写入如下信息：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></tbody></table></figure>

<p>之后在控制台使用 <strong>kubectl create -f nginx-namespace.yaml</strong> 执行命名空间的创建。完成后可以在控制台查看命名空间</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动可视化控制台（推荐使用新的终端窗口来执行）</span></span><br><span class="line">minikube dashboard</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051004323.png"></p>
<h3 id="deployment的创建"><a href="#deployment的创建" class="headerlink" title="deployment的创建"></a>deployment 的创建</h3><ol>
<li>同样，我们再创建一个 yaml 文件 (这里文件名为 nginx-deployment.yaml)，用来创建 deployment</li>
</ol>
<blockquote>
<p>kind：这次资源类型指定为 Deployment</p>
<p>metadata：在信息中设置命名空间，以及 Deployment 的名字</p>
<p>spec：用来定义资源的状态。</p>
<p>​	replicas 为 Pod 副本数量，这里我们开启 3 个 Pod；</p>
<p>​	selector 为选择器，指示哪些 Pod 属于该 deployment，这里选择模板类型为 nginx 的 Pod (和下面的模板中的 labels.app 对应)</p>
<p>​	template 为模板，指定创建 Pod 的模板信息，包含标签和容器信息。</p>
<p>​		containers 是容器信息，使用 name 指定容器的名称、以及镜像，并且定义对应的监听端口号</p>
</blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.14.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>继续使用 <strong>kubectl create -f nginx-deployment.yaml</strong> 创建 deployment</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051016273.png" alt="image-20231205101621235"></p>
<h3 id="Service的创建"><a href="#Service的创建" class="headerlink" title="Service的创建"></a>Service 的创建</h3><ol>
<li>现在我们的 Pod 就已经创建完成了，可以在工作负载查看目前的工作情况，但我们仍需要访问到 nginx 的主界面才行，上面说了，Service 是提供对外服务访问的，现在来创建一个 Service。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051017267.png" alt="image-20231205101705236"></p>
<ol start="2">
<li>同样，我们再创建一个 yaml 文件 (这里文件名为 nginx-service.yaml)，用来创建 Service</li>
</ol>
<blockquote>
<p>kind：声明创建类型为 Service</p>
<p>metadata：声明 Service 的名字</p>
<p>spec：</p>
<p>​	selector 选择器使用 app 为 nginx 的做为后端 (对应 deployment 的 template)</p>
<p>​	ports 中使用 protocol 指定服务协议，这里使用 TCP 协议；port 是 Service 的对外端口号，targetPort 是监听 Pod 的端口号，相当于将 Service 端口号流量转发到 Pod 的 80 端口。</p>
<p>​	type：type 的值常用的有三个，分别为 <strong>ClusterIP（创建一个仅在集群内部可访问的虚拟 IP）</strong>、<strong>NodePort（每个节点上绑定一个端口）</strong>、<strong>LoadBalancer（负载均衡，须使用云平台）</strong> 这里我们使用 NodePort 即可</p>
</blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">9345</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>使用 <strong>kubectl -n nginx create -f nginx-service.yaml</strong> 创建 Service （<strong>这里注意使用 - n 来将 deployment 创建到名为 nginx 的命名空间，deployment 不用 - n 指定命名空间是因为在 metadata 内指定了命名空间</strong>）</li>
</ol>
<p>下面我们就可以到控制台内的 Service 查看情况了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051034857.png" alt="image-20231205103402809"></p>
<p>也可以在 deployment 内编辑副本数量，感受容器编排的快感</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051035679.png" alt="image-20231205103528642"></p>
<p>这里将副本从 3 个增加到 10 个</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051035704.png" alt="image-20231205103544671"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051036828.png" alt="image-20231205103615797"></p>
<p>接下来我们启动 Service 并访问</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minikube -n nginx service nginx-service --url</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051338509.png" alt="image-20231205133829423"></p>
<p>打开对应的端口，成功访问到 nginx</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312051339792.png"></p>
<h3 id="kubectl常用命令"><a href="#kubectl常用命令" class="headerlink" title="kubectl常用命令"></a>kubectl 常用命令</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取Pod信息</span></span><br><span class="line">kubectl get Pods</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取命名空间为nginx的Pod信息</span></span><br><span class="line">kubectl -n nginx get Pods</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取deployment信息</span></span><br><span class="line">kubectl get deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取命名空间为nginx的deployment信息</span></span><br><span class="line">kubectl -n nginx get deployment</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取Services信息（services可以使用svc替换）</span></span><br><span class="line">kubectl get services</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取命名空间为nginx的services信息（services可以使用svc替换）</span></span><br><span class="line">kubectl -n nginx get services</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取所有的命名空间</span></span><br><span class="line">kubectl get namespaces</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取集群节点信息</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建资源</span></span><br><span class="line">kubectl create -f &lt;yaml-file&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>本文只是对 K8s 的一个初步的简单了解，后面对 K8s 达到一定程度的理解后，会继续出一期更深度的理解笔记。希望本文可以帮助到想了解 K8s 的同学～</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://33sora.com/">Sora33</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://33sora.com/posts/4f8031b.html">http://33sora.com/posts/4f8031b.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://33sora.com" target="_blank">Sora33</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/K8s/">K8s</a><a class="post-meta__tags" href="/tags/kubernetes/">kubernetes</a></div><div class="post-share"><div class="social-share" data-image="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-6dpjm6_1920x1080.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/9f27421d.html" title="在 Java 后端实现对 xxlJob 的任务管理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0817/wallhaven-dprlej_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">在 Java 后端实现对 xxlJob 的任务管理</div></div><div class="info-2"><div class="info-item-1">前言最近需要在 Java 后端操作 xxl 任务调度平台来完成任务的加入，在网上找了发现全都需要修改 admin 服务，对于已经上线的项目来说，明显不好操作切繁琐，修改 admin 服务的原因也很简单，是因为在外部直接调用添加、修改任务方法时，会被拦截告诉未登陆，因此需要在源码内多补充几个方法同时加上绕过登陆的注解。那么有没有一种办法可以不修改源码也可以操作 admin 服务内的方法呢。看了 xxlJob 的源码部分发现是可行的，在页面内我们可以发现登陆 xxlJob 后会返回一个 cookie，那么我们就借助这个 cookie 来辅助我们登陆！ 不了解 xxlJob 的朋友可以看一下上一篇：项目接入 xxl-job 工具类介绍及使用我自己已经封装了一个工具类用来帮助我们操作 admin 服务，使用也很简单。首先对工具类进行一个简单的介绍，流程框架为 调用登陆方法获取 cookie &gt;&gt;&gt; 携带 cookie 和参数访问指定方法 &gt;&gt;&gt; 返回结果 在使用工具类之前，我们只需要手动修改三个值以及引入一个实体类即可，分别是 xxlJob...</div></div></div></a><a class="pagination-related" href="/posts/1a493c07.html" title="微服务项目基于 springdoc 快速接入 swagger3"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-zy5p8v_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">微服务项目基于 springdoc 快速接入 swagger3</div></div><div class="info-2"><div class="info-item-1">环境说明 SpringBoot：3.0.2 SpringCloud：2022.0.0 SpringCloudAlibaba：2022.0.0.0-RC2 jackson：2.15.2 springdoc：2.2.0  这里也放一张官方与 SpringBoot 的版本关系  本次是基于 SpringBoot3 搭建的微服务做演示，因为升级 SpringBoot3 后，重构升级了很多东西，所以重新把 swagger 的引入记录一下。不过好消息是接入与使用非常简单。 我这里简单说一下我的项目结构，基本上是和 ruoyi 一样的 主要是 common，这里我们也只需要关注 swagger 模块即可。我在 common 下新建了一个模块，名为 swagger。主要作用是把 swagger 相关的东西放在这，方便管理。之后其他业务模块只需要引入 sora-common 即可完成对 swagger 的引入。后面也会基于此环境进行搭建与演示。  依赖引入在 swagger 模块内引入 springdoc 依赖（只需要引入此依赖即可） 12345&lt;dependency&gt; ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/4a355187.html" title="【从零开始的 K8s-02】ingress-nginx 的认识与使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-26</div><div class="info-item-2">【从零开始的 K8s-02】ingress-nginx 的认识与使用</div></div><div class="info-2"><div class="info-item-1">认识 Ingress-nginx我们先来看一下官网对于 ingress 的解释：  Ingress 提供从集群外部到集群内服务的 HTTP 和 HTTPS 路由。流量路由由 Ingress 资源所定义的规则来控制。下面是 Ingress 的一个简单示例，可将所有流量都发送到同一 Service：   通俗的理解，我们可以将 ingress 理解为 cloud 项目里的网关，通过判断请求信息、请求路径后，转发到对应的服务内。 常见的 ingress 控制器有 ingress-nginx、Traefik、HAProxy Ingress 等等，但使用最多的还是 nginx，本文也会以 ingress-nginx 来做演示 PS：ingress-nginx 是 kubernetes 社区维护的，而 kubernetes-ingress 是 nginx 官方维护的，本文使用前者！ minikube安装 Ingress-nginx 控制器运行下面的命令进行安装 1kubectl apply -f...</div></div></div></a><a class="pagination-related" href="/posts/309ad6ee.html" title="多服务器 Kubernetes 集群的部署"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-kwpy3d_1920x1080.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-01</div><div class="info-item-2">多服务器 Kubernetes 集群的部署</div></div><div class="info-2"><div class="info-item-1">环境介绍 服务器及系统版本：2 台阿里云服务器，Cenos7.8 版本  Kubernetes 版本：最新版（截止本文时间 24 年 4 月 1 日，最新版为 1.29.3） 服务器配置：4 核 8G Docker 版本：最新版（截止本文时间 24 年 4 月 1 日，最新版为 26.0.0） cri-dockerd 版本：最新版（截止本文时间 24 年 4 月 1 日，最新版为 0.3.12） 网络插件 Calico 版本：最新版（截止本文时间 24 年 4 月 1 日，最新版为 3.27.2）  前置准备 2 台或以上阿里云服务器，配置至少为 4 核 8G  因为需要从 GitHub 上下载东西，需要可以下载东西的网络 教程内出现的所有命令，如未特殊标注则默认是在每台机器上都要执行！！！  本文会从机器基础配置、基础插件安装、docker 及其 cri-dockerd、Kubernetes 以及最后的可视化 kuboard 的安装，循序渐进，并且会在每一步进行对应的解析，来更好的帮助理解 机器基础配置1....</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Sora33</div><div class="author-info-description">未来无限可能</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2097665736&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/img/sora33QR.jpg" target="_blank" title="VX"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Java/自宅警备员/nayuta单推人<br>本站主要记录自己自学的一些技术,欢迎各位一起留言讨论。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#minikube"><span class="toc-number">2.</span> <span class="toc-text">minikube</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85minikube"><span class="toc-number">3.</span> <span class="toc-text">安装 minikube</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mac%EF%BC%88%E4%BD%BF%E7%94%A8homebrew%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">mac（使用 homebrew）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windows"><span class="toc-number">3.2.</span> <span class="toc-text">windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux"><span class="toc-number">3.3.</span> <span class="toc-text">linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#K8s%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.</span> <span class="toc-text">K8s 概念介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod"><span class="toc-number">4.1.</span> <span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#depolyment"><span class="toc-number">4.2.</span> <span class="toc-text">depolyment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-number">4.3.</span> <span class="toc-text">Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ingress"><span class="toc-number">4.4.</span> <span class="toc-text">Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#namespace"><span class="toc-number">4.5.</span> <span class="toc-text">namespace</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Enginx%E8%BF%9B%E8%A1%8C%E6%BC%94%E7%A4%BA"><span class="toc-number">5.</span> <span class="toc-text">基于 nginx 进行演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">5.1.</span> <span class="toc-text">命名空间的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deployment%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">5.2.</span> <span class="toc-text">deployment 的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">5.3.</span> <span class="toc-text">Service 的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubectl%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.4.</span> <span class="toc-text">kubectl 常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="toc-number">6.</span> <span class="toc-text">结束语</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/16a3faad.html" title="如何将自己的 jar 包发布到 Maven 中央仓库？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-o5mggm_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何将自己的 jar 包发布到 Maven 中央仓库？"/></a><div class="content"><a class="title" href="/posts/16a3faad.html" title="如何将自己的 jar 包发布到 Maven 中央仓库？">如何将自己的 jar 包发布到 Maven 中央仓库？</a><time datetime="2024-12-19T02:42:15.000Z" title="发表于 2024-12-19 10:42:15">2024-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/89e44969.html" title="hexo &amp; butterfly 升级与注意要点"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-6d2l9q_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo &amp; butterfly 升级与注意要点"/></a><div class="content"><a class="title" href="/posts/89e44969.html" title="hexo &amp; butterfly 升级与注意要点">hexo &amp; butterfly 升级与注意要点</a><time datetime="2024-12-09T07:10:21.000Z" title="发表于 2024-12-09 15:10:21">2024-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/41ed1960.html" title="基于 ollama 从零部署大语言模型"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-o559j7_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 ollama 从零部署大语言模型"/></a><div class="content"><a class="title" href="/posts/41ed1960.html" title="基于 ollama 从零部署大语言模型">基于 ollama 从零部署大语言模型</a><time datetime="2024-09-27T05:33:47.000Z" title="发表于 2024-09-27 13:33:47">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ef6e6a13.html" title="个人对设计模式的理解与实践 (持续缓更)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0817/wallhaven-57erm8_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="个人对设计模式的理解与实践 (持续缓更)"/></a><div class="content"><a class="title" href="/posts/ef6e6a13.html" title="个人对设计模式的理解与实践 (持续缓更)">个人对设计模式的理解与实践 (持续缓更)</a><time datetime="2024-09-10T05:24:04.000Z" title="发表于 2024-09-10 13:24:04">2024-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/144a2659.html" title="Java21 虚拟线程的研究与使用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-3l3ed3_3440x1440.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java21 虚拟线程的研究与使用"/></a><div class="content"><a class="title" href="/posts/144a2659.html" title="Java21 虚拟线程的研究与使用">Java21 虚拟线程的研究与使用</a><time datetime="2024-08-13T01:49:33.000Z" title="发表于 2024-08-13 09:49:33">2024-08-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-6dpjm6_1920x1080.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By Sora33</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn"><span>晋ICP备2022007182号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><a class="rightMenu-item menu-link" id="menu-radompage" href="/index.html"><i class="fa-solid fa-shoe-prints"></i><span>随便逛逛</span></a><div class="rightMenu-item" id="menu-translate"><i class="fa-solid fa-earth-asia"></i><span>繁简切换</span></div><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://sprightly-liger-8d5ebf.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://sprightly-liger-8d5ebf.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>