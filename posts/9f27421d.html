<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>在 Java 后端实现对 xxlJob 的任务管理 | Sora33</title><meta name="author" content="Sora33"><meta name="copyright" content="Sora33"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言最近需要在 Java 后端操作 xxl 任务调度平台来完成任务的加入，在网上找了发现全都需要修改 admin 服务，对于已经上线的项目来说，明显不好操作切繁琐，修改 admin 服务的原因也很简单，是因为在外部直接调用添加、修改任务方法时，会被拦截告诉未登陆，因此需要在源码内多补充几个方法同时加上绕过登陆的注解。那么有没有一种办法可以不修改源码也可以操作 admin 服务内的方法呢。看了 xx">
<meta property="og:type" content="article">
<meta property="og:title" content="在 Java 后端实现对 xxlJob 的任务管理">
<meta property="og:url" content="http://33sora.com/posts/9f27421d.html">
<meta property="og:site_name" content="Sora33">
<meta property="og:description" content="前言最近需要在 Java 后端操作 xxl 任务调度平台来完成任务的加入，在网上找了发现全都需要修改 admin 服务，对于已经上线的项目来说，明显不好操作切繁琐，修改 admin 服务的原因也很简单，是因为在外部直接调用添加、修改任务方法时，会被拦截告诉未登陆，因此需要在源码内多补充几个方法同时加上绕过登陆的注解。那么有没有一种办法可以不修改源码也可以操作 admin 服务内的方法呢。看了 xx">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png">
<meta property="article:published_time" content="2023-12-29T06:55:43.000Z">
<meta property="article:modified_time" content="2024-01-19T07:52:50.515Z">
<meta property="article:author" content="Sora33">
<meta property="article:tag" content="xxl">
<meta property="article:tag" content="任务调度">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://33sora.com/posts/9f27421d.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 8 || hour >= 19
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"1QY6GKFJYT","apiKey":"ff7af72210f9015cb3c5205c3a3824e2","indexName":"dev_home","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '在 Java 后端实现对 xxlJob 的任务管理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/rightMenu.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="pokeball-loading"><div class="pokeball" id="normal"></div><div class="pokeball" id="great"></div><div class="pokeball" id="ultra"></div><div class="pokeball" id="master"></div><div class="pokeball" id="safari"></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = 'auto'
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0817/wallhaven-g7mpj7_1920x1080.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">71</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-wheelchair-alt"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" alt="Logo"><span class="site-name">Sora33</span></a><a class="nav-page-title" href="/"><span class="site-name">在 Java 后端实现对 xxlJob 的任务管理</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-wheelchair-alt"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">在 Java 后端实现对 xxlJob 的任务管理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-12-29T06:55:43.000Z" title="发表于 2023-12-29 14:55:43">2023-12-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>11分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:300,&quot;messagePrev&quot;:&quot;距离最后更新已经过了&quot;,&quot;messageNext&quot;:&quot;天，文章内容可能已过时，如果有问题，欢迎留言反馈&quot;,&quot;postUpdate&quot;:&quot;2024-01-19 15:52:50&quot;}" hidden></div><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近需要在 Java 后端操作 xxl 任务调度平台来完成任务的加入，在网上找了发现全都需要修改 admin 服务，对于已经上线的项目来说，明显不好操作切繁琐，修改 admin 服务的原因也很简单，是因为在外部直接调用添加、修改任务方法时，会被拦截告诉未登陆，因此需要在源码内多补充几个方法同时加上绕过登陆的注解。那么有没有一种办法可以不修改源码也可以操作 admin 服务内的方法呢。看了 xxlJob 的源码部分发现是可行的，在页面内我们可以发现登陆 xxlJob 后会返回一个 cookie，那么我们就借助这个 cookie 来辅助我们登陆！</p>
<p>不了解 xxlJob 的朋友可以看一下上一篇：<a href="https://33sora.com/posts/6efdf379.html">项目接入 xxl-job</a></p>
<h2 id="工具类介绍及使用"><a href="#工具类介绍及使用" class="headerlink" title="工具类介绍及使用"></a>工具类介绍及使用</h2><p>我自己已经封装了一个工具类用来帮助我们操作 admin 服务，使用也很简单。首先对工具类进行一个简单的介绍，流程框架为 调用登陆方法获取 cookie &gt;&gt;&gt; 携带 cookie 和参数访问指定方法 &gt;&gt;&gt; 返回结果</p>
<p>在使用工具类之前，<strong>我们只需要手动修改三个值以及引入一个实体类即可</strong>，分别是 xxlJob 的地址、账号和密码。</p>
<p>实体类如下，主要是帮助我们转换为正确的调度任务对象集合</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sora.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * xxl-jobInfo实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxlJobInfo</span> {</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> id;             <span class="comment">// 主键ID</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> jobGroup;     <span class="comment">// 执行器主键ID</span></span><br><span class="line">   <span class="keyword">private</span> String jobDesc;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Date addTime;</span><br><span class="line">   <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String author;    <span class="comment">// 负责人</span></span><br><span class="line">   <span class="keyword">private</span> String alarmEmail; <span class="comment">// 报警邮件</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String scheduleType;         <span class="comment">// 调度类型</span></span><br><span class="line">   <span class="keyword">private</span> String scheduleConf;         <span class="comment">// 调度配置，值含义取决于调度类型</span></span><br><span class="line">   <span class="keyword">private</span> String misfireStrategy;          <span class="comment">// 调度过期策略</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String executorRouteStrategy;  <span class="comment">// 执行器路由策略</span></span><br><span class="line">   <span class="keyword">private</span> String executorHandler;           <span class="comment">// 执行器，任务Handler名称</span></span><br><span class="line">   <span class="keyword">private</span> String executorParam;         <span class="comment">// 执行器，任务参数</span></span><br><span class="line">   <span class="keyword">private</span> String executorBlockStrategy;  <span class="comment">// 阻塞处理策略</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> executorTimeout;          <span class="comment">// 任务执行超时时间，单位秒</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> executorFailRetryCount;       <span class="comment">// 失败重试次数</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String glueType;      <span class="comment">// GLUE类型  #com.xxl.job.core.glue.GlueTypeEnum</span></span><br><span class="line">   <span class="keyword">private</span> String glueSource;    <span class="comment">// GLUE源代码</span></span><br><span class="line">   <span class="keyword">private</span> String glueRemark;    <span class="comment">// GLUE备注</span></span><br><span class="line">   <span class="keyword">private</span> Date glueUpdatetime;   <span class="comment">// GLUE更新时间</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String childJobId;    <span class="comment">// 子任务ID，多个逗号分隔</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> triggerStatus;    <span class="comment">// 调度状态：0-停止，1-运行</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">long</span> triggerLastTime;  <span class="comment">// 上次调度时间</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">long</span> triggerNextTime;  <span class="comment">// 下次调度时间</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在工具类里，我对 cookie 做了一个存入本地 map 的操作，这样只需要访问一次登陆接口，后续直接从 map 获取即可（目前没有发现 cookie 过期，如果有可以在过期后再次访问登陆接口刷新 cookie 的值）</p>
<p>因为 xxlJob 的参数都是 formData 格式，所以我这里添加、修改任务的时候需要把整个 map 传递过去。下面简单说一下各个方法如何使用</p>
<blockquote>
<p>login（登陆）：用于获取访问 admin 服务的 cookie，不需要我们去调用，工具类会自动调用该方法并存入 cookieMap 完成 cookie 的获取</p>
<p>getCookie（获取 cookie）：从 cookieMap 内获取 cookie，没有 cookie 则访问 login 方法</p>
<p>addJob（添加调度任务）：传入一个 map，key 为 xxlJobInfo 的字段名，value 则为值，进行任务的添加</p>
<p>updateJob（修改调度任务）：传入一个 map，key 为 xxlJobInfo 的字段名，value 则为值，进行任务的修改</p>
<p>startJob（开启调度任务）：传入一个 long 类型的任务 id，将该任务的 TriggerStatus 字段设置为 1，开始执行</p>
<p>stopJob（停止调度任务）：传入一个 long 类型的任务 id，将该任务的 TriggerStatus 字段设置为 0，停止执行</p>
<p>removeJob（移除调度任务）：传入一个 long 类型的任务 id，删除该任务</p>
<p>pageList（获取所有调度任务）：传入执行器 id，获取该执行器下所有调度任务，返回 XxlJobInfo 类型的集合</p>
<p>link（访问 admin 服务）：使用 OkHttp 远程调用访问 admin，内部调用 postFormDataResponse 方法</p>
<p>postFormDataResponse（封装请求参数并获取响应）：封装响应体并请求接口</p>
<p>getHeaders（获取请求头）：获取 headers，不需要我们去调用，工具类会自动调用该方法并返回对应 headers</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sora.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.sora.domain.XxlJobInfo;</span><br><span class="line"><span class="keyword">import</span> com.sora.jackson.InitObjectMapper;</span><br><span class="line"><span class="keyword">import</span> okhttp3.*;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxlUtil</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(XxlUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * xxl地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">xxlJobAdminAddress</span> <span class="operator">=</span> <span class="string">"http://127.0.0.1:7777/xxl-job-admin"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * xxl用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER_NAME</span> <span class="operator">=</span> <span class="string">"admin"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * xxl密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD</span> <span class="operator">=</span> <span class="string">"123456"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOGIN_URL</span> <span class="operator">=</span> <span class="string">"/login"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_INFO_URL</span> <span class="operator">=</span> <span class="string">"/jobinfo/add"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REMOVE_INFO_URL</span> <span class="operator">=</span> <span class="string">"/jobinfo/remove"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPDATE_INFO_URL</span> <span class="operator">=</span> <span class="string">"/jobinfo/update"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">START_URL</span> <span class="operator">=</span> <span class="string">"/jobinfo/start"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STOP_URL</span> <span class="operator">=</span> <span class="string">"/jobinfo/stop"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAGELIST_URL</span> <span class="operator">=</span> <span class="string">"/jobinfo/pageList"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, String&gt; cookieMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder()</span><br><span class="line">            .connectTimeout(<span class="number">5L</span>, TimeUnit.SECONDS)</span><br><span class="line">                .readTimeout(<span class="number">5L</span>, TimeUnit.SECONDS)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登陆</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span> {</span><br><span class="line">        HashMap&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        paramMap.put(<span class="string">"userName"</span>, USER_NAME);</span><br><span class="line">        paramMap.put(<span class="string">"password"</span>, PASSWORD);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String, String&gt; headerMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        paramMap.put(<span class="string">"Content-Type"</span>, MediaType.APPLICATION_FORM_URLENCODED.toString());</span><br><span class="line"></span><br><span class="line">        <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> postFormDataResponse(xxlJobAdminAddress + LOGIN_URL, paramMap, headerMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查响应状态码</span></span><br><span class="line">        <span class="keyword">if</span> (response.isSuccessful()) {</span><br><span class="line">            <span class="comment">// 提取Token</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">cookie</span> <span class="operator">=</span> response.headers().get(<span class="string">"Set-Cookie"</span>);</span><br><span class="line">            cookieMap.put(<span class="string">"cookie"</span>, cookie);</span><br><span class="line">            response.close();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            logger.error(<span class="string">"登录失败，响应体："</span> + response);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取cookie</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getCookie</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">cookie</span> <span class="operator">=</span> cookieMap.get(<span class="string">"cookie"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) {</span><br><span class="line">            <span class="keyword">if</span> (cookie == <span class="literal">null</span>) {</span><br><span class="line">                login();</span><br><span class="line">                cookie = cookieMap.get(<span class="string">"cookie"</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> cookie;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> xxlJobInfoMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">addJob</span><span class="params">(HashMap&lt;String, Object&gt; xxlJobInfoMap)</span> {</span><br><span class="line">        <span class="keyword">return</span> link(xxlJobAdminAddress + ADD_INFO_URL, xxlJobInfoMap);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改任务信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> xxlJobInfoMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">updateJob</span><span class="params">(HashMap&lt;String, Object&gt; xxlJobInfoMap)</span> {</span><br><span class="line">        <span class="keyword">return</span> link(xxlJobAdminAddress + UPDATE_INFO_URL, xxlJobInfoMap);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">startJob</span><span class="params">(<span class="type">long</span> jobId)</span> {</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"id"</span>, String.valueOf(jobId));</span><br><span class="line">        <span class="keyword">return</span> link(xxlJobAdminAddress + START_URL, map);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 停止任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">stopJob</span><span class="params">(<span class="type">long</span> jobId)</span> {</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"id"</span>, String.valueOf(jobId));</span><br><span class="line">        <span class="keyword">return</span> link(xxlJobAdminAddress + STOP_URL, map);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">removeJob</span><span class="params">(<span class="type">long</span> jobId)</span> {</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"id"</span>, String.valueOf(jobId));</span><br><span class="line">        <span class="keyword">return</span> link(xxlJobAdminAddress + REMOVE_INFO_URL, map);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找调度任务列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;XxlJobInfo&gt; <span class="title function_">pageList</span><span class="params">(<span class="type">long</span> group)</span> {</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"jobGroup"</span>, group);</span><br><span class="line">        map.put(<span class="string">"triggerStatus"</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> link(xxlJobAdminAddress + PAGELIST_URL, map);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> objectMapper.readTree(response).get(<span class="string">"data"</span>).toString();</span><br><span class="line">            List&lt;XxlJobInfo&gt; xxlJobInfos = objectMapper.readValue(data, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;XxlJobInfo&gt;&gt;() {</span><br><span class="line">            });</span><br><span class="line">            <span class="keyword">return</span> xxlJobInfos;</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            logger.error(<span class="string">"json解析错误，[xxl-job工具类]调用pageList方法发生异常！！"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 与xxlJobAdmin进行交互</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">link</span><span class="params">(String url, HashMap&lt;String, Object&gt; paramMap)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">cookie</span> <span class="operator">=</span> getCookie();</span><br><span class="line">        <span class="keyword">if</span> (cookie == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line">        HashMap&lt;String, String&gt; headerMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        headerMap.put(<span class="string">"Cookie"</span>, cookie);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> postFormDataResponse(url, paramMap, headerMap);</span><br><span class="line">            <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> response.body().string();</span><br><span class="line">            response.close();</span><br><span class="line">            <span class="keyword">return</span> body;</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">"错误请求，请求xxlJob发生异常！"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封装响应体并请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> URL 请求路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap 参数map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headerMap 请求头map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Response <span class="title function_">postFormDataResponse</span><span class="params">(String URL, HashMap&lt;String, Object&gt; paramMap,HashMap&lt;String,String&gt; headerMap)</span> {</span><br><span class="line">        <span class="comment">// 获取headers</span></span><br><span class="line">        <span class="type">Headers</span> <span class="variable">headers</span> <span class="operator">=</span> getHeaders(headerMap);</span><br><span class="line"></span><br><span class="line">        MultipartBody.<span class="type">Builder</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultipartBody</span>.Builder()</span><br><span class="line">                .setType(MultipartBody.FORM);</span><br><span class="line"></span><br><span class="line">        paramMap.forEach((k,v) -&gt; {</span><br><span class="line">            data.addFormDataPart(k, v.toString());</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">                .post(data.build())</span><br><span class="line">                .url(URL)</span><br><span class="line">                .headers(headers)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">Response</span> <span class="variable">execute</span> <span class="operator">=</span> okHttpClient.newCall(request).execute();</span><br><span class="line">            <span class="keyword">if</span> (execute.isSuccessful()) {</span><br><span class="line">                <span class="keyword">return</span> execute;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">"发起请求失败！"</span>, e);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据请求头map获取对应的headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headersMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Headers <span class="title function_">getHeaders</span><span class="params">(Map&lt;String, String&gt; headersMap)</span> {</span><br><span class="line">        Headers.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Headers</span>.Builder();</span><br><span class="line">        headersMap.forEach(builder::add);</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="依赖引入"><a href="#依赖引入" class="headerlink" title="依赖引入"></a>依赖引入</h2><p>OkHttp：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>jackson:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="项目实践测试"><a href="#项目实践测试" class="headerlink" title="项目实践测试"></a>项目实践测试</h2><h3 id="新增："><a href="#新增：" class="headerlink" title="新增："></a>新增：</h3><p>这里的 key 要和 XxlJobInfo 保持一致，因为 xxlJob 需要 formData 请求，需要提交表单，所以我们需要对对象进行拆分存入 map 内，大部分的参数我都直接用值表示了，如果有疑问或者好奇，可以直接去看 XxlJobInfo 类的注释。添加成功的 content 后返回的是新增的任务 id，jobGroup 是执行器 id，可以直接去数据库的 xxl_job_group 里面查看，因为执行器我们通常不会改变，所以这里我并没有写针对执行器的方法。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/jobTest")</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">jobTest</span><span class="params">()</span> {</span><br><span class="line">       HashMap&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       paramMap.put(<span class="string">"JobGroup"</span>,<span class="number">2</span>);</span><br><span class="line">       paramMap.put(<span class="string">"JobDesc"</span>,<span class="string">"任务描述"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"executorParam"</span>,<span class="string">"我是参数"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"ExecutorHandler"</span>,<span class="string">"testHandler（handler名称）"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"alarmEmail"</span>,<span class="string">"告警邮件地址@gmail.com"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"ScheduleType"</span>,<span class="string">"CRON"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"ScheduleConf"</span>,<span class="string">"0/10 * * * * ?"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"GlueType"</span>,<span class="string">"BEAN"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"MisfireStrategy"</span>,<span class="string">"DO_NOTHING"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"ExecutorBlockStrategy"</span>,<span class="string">"SERIAL_EXECUTION"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"ExecutorRouteStrategy"</span>,<span class="string">"FIRST"</span>);</span><br><span class="line">       paramMap.put(<span class="string">"TriggerStatus"</span>,<span class="number">0</span>);</span><br><span class="line">       paramMap.put(<span class="string">"Author"</span>,<span class="string">"sora33"</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> XxlUtil.addJob(paramMap);</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           <span class="type">JsonNode</span> <span class="variable">jsonNode</span> <span class="operator">=</span> objectMapper.readTree(string);</span><br><span class="line">           <span class="type">JsonNode</span> <span class="variable">content</span> <span class="operator">=</span> jsonNode.get(<span class="string">"content"</span>);</span><br><span class="line">           <span class="keyword">return</span> Result.success(content);</span><br><span class="line">       } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">           <span class="keyword">return</span> Result.success(<span class="literal">null</span>);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p>查看数据库，数据添加成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312291609965.png" alt="image-20231229160920295"></p>
<h3 id="修改："><a href="#修改：" class="headerlink" title="修改："></a>修改：</h3><p>修改其实和添加一样，只不过需要我们多加入一个参数 id，传入一个已经存在的任务 id，并传入修改后的值，例如我需要把告警邮件修改了则可以如下设置（这里要把任务所有的属性都传入，哪怕是不修改的属性，不然会报缺少 xx 字段的提示）</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">jobTest</span><span class="params">()</span> {</span><br><span class="line">  HashMap&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  paramMap.put(<span class="string">"JobGroup"</span>,<span class="number">2</span>);</span><br><span class="line">  paramMap.put(<span class="string">"id"</span>,<span class="number">47</span>);</span><br><span class="line">  paramMap.put(<span class="string">"JobDesc"</span>,<span class="string">"任务描述"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"executorParam"</span>,<span class="string">"我是参数"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"ExecutorHandler"</span>,<span class="string">"testHandler（handler名称）"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"alarmEmail"</span>,<span class="string">"二次告警邮件地址@gmail.com"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"ScheduleType"</span>,<span class="string">"CRON"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"ScheduleConf"</span>,<span class="string">"0/10 * * * * ?"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"GlueType"</span>,<span class="string">"BEAN"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"MisfireStrategy"</span>,<span class="string">"DO_NOTHING"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"ExecutorBlockStrategy"</span>,<span class="string">"SERIAL_EXECUTION"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"ExecutorRouteStrategy"</span>,<span class="string">"FIRST"</span>);</span><br><span class="line">  paramMap.put(<span class="string">"TriggerStatus"</span>,<span class="number">0</span>);</span><br><span class="line">  paramMap.put(<span class="string">"Author"</span>,<span class="string">"sora33"</span>);</span><br><span class="line">  <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> XxlUtil.updateJob(paramMap);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>数据库修改成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312291611265.png" alt="image-20231229161154216"></p>
<h3 id="删除-开启任务-暂停任务："><a href="#删除-开启任务-暂停任务：" class="headerlink" title="删除/开启任务/暂停任务："></a>删除 / 开启任务 / 暂停任务：</h3><p>这三类任务很简单，直接传入需要的任务 id 即可。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">jobTest</span><span class="params">()</span> {</span><br><span class="line">    XxlUtil.startJob(<span class="number">47L</span>);</span><br><span class="line">    XxlUtil.stopJob(<span class="number">48L</span>);</span><br><span class="line">    XxlUtil.removeJob(<span class="number">45</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如下，启用 id 为 47 的调度任务，停用 48 的调度任务，删除 45 的调度任务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312291620077.png" alt="image-20231229162058032"></p>
<h3 id="获取所有任务："><a href="#获取所有任务：" class="headerlink" title="获取所有任务："></a>获取所有任务：</h3><p>调用 pageList 方法，并传入执行器 id，获取该执行器下的所有任务</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">jobTest</span><span class="params">()</span> {</span><br><span class="line">    List&lt;XxlJobInfo&gt; xxlJobInfos = XxlUtil.pageList(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 获取id为44的任务</span></span><br><span class="line">    <span class="type">XxlJobInfo</span> <span class="variable">jobInfo</span> <span class="operator">=</span> xxlJobInfos.stream()</span><br><span class="line">            .filter(data -&gt; data.getId() == <span class="number">44</span>)</span><br><span class="line">            .findFirst()</span><br><span class="line">            .orElse(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success(jobInfo);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202312291630233.png" alt="image-20231229163018171"></p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>工具类的介绍及使用到这里就结束了，有任何想法或者疑问的可以联系我，如果本篇文章对你有用，欢迎分享给其他人，最后也到了元旦，祝各位元旦快乐～</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://33sora.com/">Sora33</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://33sora.com/posts/9f27421d.html">http://33sora.com/posts/9f27421d.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://33sora.com" target="_blank">Sora33</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/xxl/">xxl</a><a class="post-meta__tags" href="/tags/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/">任务调度</a></div><div class="post-share"><div class="social-share" data-image="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/4b0e020.html" title="mybatis-flex 框架的学习与使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-vq3lol_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">mybatis-flex 框架的学习与使用</div></div><div class="info-2"><div class="info-item-1">前言最近发现了这个新框架，想着学习一下发现网上的教程几乎全是对官网的复制粘贴…… 很多细节要点都没有告诉你，很容易让人看的一头雾水，所以自己跟着官网文档做了一个示例 Demo，写个教程做记录，也分享给需要的各位（后面会使用 flex 指代 mybatis-flex、plus 指代 mybatis-plus） 常见问题这里我把常见问题放在前面是因为有很多坑，所以我想先把我踩过的坑列出来，提前了解，不然后面问题很多不好解释。这些坑我也都是从官网找的对应解决方法，在这里放出来同时加深一下印象。 如何使用分页 以前我们 mybatis-plus 会搭配 pagehelper-spring-boot-starter 依赖来实现分页，但是使用 mybatis-flex 后，请注意，将分页依赖更换为 pagehelper 依赖 原因是 pagehelper-spring-boot-starter 依赖的 mybatis-spring-boot-starter 会使 flex 启动异常，导致查询时参数赋值不上，会产生《No value specified for parameter...</div></div></div></a><a class="pagination-related" href="/posts/4f8031b.html" title="【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-l8ljyr_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【从零开始的 K8s-01】基于 minikube 搭建一个本地 K8s 环境</div></div><div class="info-2"><div class="info-item-1">前言minikube 可以做到在本地部署 kubernetes (也叫 K8s，后面会用 K8s 指代 kubernetes) 环境、以单节点集群环境运行，非常方便个人测试和学习。个人也打算使用 minikube 来当作练手，在差不多搞清楚 K8s 的运作原理以及各种配置后，再上多台服务器搭建的真正的 K8s 环境。所以希望本文可以帮助更多人以更轻松的方式学习，并初步了解 K8s 究竟是什么东西。 多台服务器的 Kubernetes 搭建 minikube这里先放上源代码，以及 K8s 的官网 minikube				minikube(github)				kubenates 正如前面所说，minikube 可以在本地计算机上运行单节点 Kubernetes 集群的工具。易于安装和使用，那么我们首先需要在本地安装 minikube 安装 minikubePS：请先安装好 docker 再继续下面的步骤，因为 minikube 需要依赖于虚拟化软件来创建和管理虚拟机；本人只有 mac 环境是自己走了一遍，windows 与 linux...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/6efdf379.html" title="SpringBoot 整合 xxl-job"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/xxl.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-20</div><div class="info-item-2">SpringBoot 整合 xxl-job</div></div><div class="info-2"><div class="info-item-1">官网上是这么介绍 xxl-job 的:  XXL-JOB 是一个分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并接入多家公司线上产品线，开箱即用。 特性  1、简单：支持通过 Web 页面对任务进行 CRUD 操作，操作简单，一分钟上手； 2、动态：支持动态修改任务状态、启动 / 停止任务，以及终止运行中任务，即时生效； 3、调度中心 HA（中心式）：调度采用中心式设计，“调度中心” 自研调度组件并支持集群部署，可保证调度中心 HA； 4、执行器 HA（分布式）：任务分布式执行，任务” 执行器” 支持集群部署，可保证任务执行 HA； 5、注册中心：执行器会周期性自动注册任务，调度中心将会自动发现注册的任务并触发执行。同时，也支持手动录入执行器地址； 6、弹性扩容缩容：一旦有新执行器机器上线或者下线，下次调度时将会重新分配任务； 7、触发策略：提供丰富的任务触发策略，包括：Cron...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Sora33</div><div class="author-info-description">未来无限可能</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">71</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2097665736&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/img/sora33QR.jpg" target="_blank" title="VX"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Java/自宅警备员/nayuta单推人<br>本站主要记录自己自学的一些技术,欢迎各位一起留言讨论。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">工具类介绍及使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%BC%95%E5%85%A5"><span class="toc-number">3.</span> <span class="toc-text">依赖引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5%E6%B5%8B%E8%AF%95"><span class="toc-number">4.</span> <span class="toc-text">项目实践测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">新增：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%EF%BC%9A"><span class="toc-number">4.2.</span> <span class="toc-text">修改：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-%E5%BC%80%E5%90%AF%E4%BB%BB%E5%8A%A1-%E6%9A%82%E5%81%9C%E4%BB%BB%E5%8A%A1%EF%BC%9A"><span class="toc-number">4.3.</span> <span class="toc-text">删除 &#x2F; 开启任务 &#x2F; 暂停任务：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E4%BB%BB%E5%8A%A1%EF%BC%9A"><span class="toc-number">4.4.</span> <span class="toc-text">获取所有任务：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结束语</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/5bf17f0.html" title="使用 CUDA 部署 LLM、TTS、ASR 三种类型的开源模型"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-286pxm_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 CUDA 部署 LLM、TTS、ASR 三种类型的开源模型"/></a><div class="content"><a class="title" href="/posts/5bf17f0.html" title="使用 CUDA 部署 LLM、TTS、ASR 三种类型的开源模型">使用 CUDA 部署 LLM、TTS、ASR 三种类型的开源模型</a><time datetime="2025-05-28T01:47:30.000Z" title="发表于 2025-05-28 09:47:30">2025-05-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a39037a1.html" title="在 java 中使用 deepseek 并接入联网搜索和知识库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-y8j3qk_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在 java 中使用 deepseek 并接入联网搜索和知识库"/></a><div class="content"><a class="title" href="/posts/a39037a1.html" title="在 java 中使用 deepseek 并接入联网搜索和知识库">在 java 中使用 deepseek 并接入联网搜索和知识库</a><time datetime="2025-03-06T08:15:40.000Z" title="发表于 2025-03-06 16:15:40">2025-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dcc14389.html" title="写了一个 Java 中过滤实体类字段的小项目"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-p9ky1p_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="写了一个 Java 中过滤实体类字段的小项目"/></a><div class="content"><a class="title" href="/posts/dcc14389.html" title="写了一个 Java 中过滤实体类字段的小项目">写了一个 Java 中过滤实体类字段的小项目</a><time datetime="2024-12-24T08:12:50.000Z" title="发表于 2024-12-24 16:12:50">2024-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/16a3faad.html" title="如何将自己的 jar 包发布到 Maven 中央仓库？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-zy6vgv_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何将自己的 jar 包发布到 Maven 中央仓库？"/></a><div class="content"><a class="title" href="/posts/16a3faad.html" title="如何将自己的 jar 包发布到 Maven 中央仓库？">如何将自己的 jar 包发布到 Maven 中央仓库？</a><time datetime="2024-12-19T02:42:15.000Z" title="发表于 2024-12-19 10:42:15">2024-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/89e44969.html" title="hexo &amp; butterfly 升级与注意要点"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-m9ozwm_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo &amp; butterfly 升级与注意要点"/></a><div class="content"><a class="title" href="/posts/89e44969.html" title="hexo &amp; butterfly 升级与注意要点">hexo &amp; butterfly 升级与注意要点</a><time datetime="2024-12-09T07:10:21.000Z" title="发表于 2024-12-09 15:10:21">2024-12-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Sora33</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn"><span>晋ICP备2022007182号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://sprightly-liger-8d5ebf.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://sprightly-liger-8d5ebf.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>