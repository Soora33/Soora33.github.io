<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>个人对设计模式的理解与实践 (持续缓更) | Sora33</title><meta name="author" content="Sora33"><meta name="copyright" content="Sora33"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="设计模式设计模式是什么？设计模式是我们对问题所提出的解决方案，就像一个个蓝图，通过对问题的一些综合考虑，采用最合适的设计方案来解决问题。就像一个工具箱，我们要看具体的情况，来决定使用哪把工具。那么设计模式是如何诞生的呢，设计模式最开始也是一个解决方案，只不过这个方案在各种项目中得到了验证。最终得到认可，是前辈们一个个试验，一步一个坑踩过来，最终被后人们整理，收纳，所归类的出的一种新领域 设计模式的">
<meta property="og:type" content="article">
<meta property="og:title" content="个人对设计模式的理解与实践 (持续缓更)">
<meta property="og:url" content="http://33sora.com/posts/ef6e6a13.html">
<meta property="og:site_name" content="Sora33">
<meta property="og:description" content="设计模式设计模式是什么？设计模式是我们对问题所提出的解决方案，就像一个个蓝图，通过对问题的一些综合考虑，采用最合适的设计方案来解决问题。就像一个工具箱，我们要看具体的情况，来决定使用哪把工具。那么设计模式是如何诞生的呢，设计模式最开始也是一个解决方案，只不过这个方案在各种项目中得到了验证。最终得到认可，是前辈们一个个试验，一步一个坑踩过来，最终被后人们整理，收纳，所归类的出的一种新领域 设计模式的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png">
<meta property="article:published_time" content="2024-09-10T05:24:04.000Z">
<meta property="article:modified_time" content="2024-12-11T02:36:32.638Z">
<meta property="article:author" content="Sora33">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://33sora.com/posts/ef6e6a13.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 8 || hour >= 19
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"1QY6GKFJYT","apiKey":"ff7af72210f9015cb3c5205c3a3824e2","indexName":"dev_home","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '个人对设计模式的理解与实践 (持续缓更)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/rightMenu.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="pokeball-loading"><div class="pokeball" id="normal"></div><div class="pokeball" id="great"></div><div class="pokeball" id="ultra"></div><div class="pokeball" id="master"></div><div class="pokeball" id="safari"></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = 'auto'
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0817/wallhaven-g7mpj7_1920x1080.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">63</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-wheelchair-alt"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" alt="Logo"><span class="site-name">Sora33</span></a><a class="nav-page-title" href="/"><span class="site-name">个人对设计模式的理解与实践 (持续缓更)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-calendar"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-wheelchair-alt"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">个人对设计模式的理解与实践 (持续缓更)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-09-10T05:24:04.000Z" title="发表于 2024-09-10 13:24:04">2024-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BA%95%E5%B1%82%E7%90%86%E8%AE%BA/">底层理论</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BA%95%E5%B1%82%E7%90%86%E8%AE%BA/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">技术学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">14.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>52分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:300,&quot;messagePrev&quot;:&quot;距离最后更新已经过了&quot;,&quot;messageNext&quot;:&quot;天，文章内容可能已过时，如果有问题，欢迎留言反馈&quot;,&quot;postUpdate&quot;:&quot;2024-12-11 10:36:32&quot;}" hidden></div><h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><h3 id="设计模式是什么？"><a href="#设计模式是什么？" class="headerlink" title="设计模式是什么？"></a>设计模式是什么？</h3><p>设计模式是我们对问题所提出的解决方案，就像一个个蓝图，通过对问题的一些综合考虑，采用最合适的设计方案来解决问题。就像一个工具箱，我们要看具体的情况，来决定使用哪把工具。那么设计模式是如何诞生的呢，设计模式最开始也是一个解决方案，只不过这个方案在各种项目中得到了验证。最终得到认可，是前辈们一个个试验，一步一个坑踩过来，最终被后人们整理，收纳，所归类的出的一种新领域</p>
<h3 id="设计模式的优点"><a href="#设计模式的优点" class="headerlink" title="设计模式的优点"></a>设计模式的优点</h3><ul>
<li>提高我们的思维能力和设计能力</li>
<li>使程序的设计变得标准化、流程化，增强开发效率</li>
<li>对代码来说，提高了可读性和复用性以及可扩展性</li>
</ul>
<h3 id="设计模式的六大原则"><a href="#设计模式的六大原则" class="headerlink" title="设计模式的六大原则"></a>设计模式的六大原则</h3><ol>
<li>单一职责： 一个类应该只有一个会引起它变化的原因，也就是一个类只负责一个职责	</li>
<li>开闭原则： 对扩展开放，对修改关闭</li>
<li>里氏代换原则： 子类应该可以替换父类对象，并保持逻辑不变</li>
<li>依赖倒转原则： 抽象不依赖细节，细节依赖于抽象。也就是对接口编程，不要直接使用实现类</li>
<li>接口隔离原则： 不应该强迫一个类实现它不需要的方法，而是使用多个精细化的接口</li>
<li>迪米特法则： 一个实体类尽量少与其他实体类有相互作用</li>
</ol>
<h3 id="设计模式的分类"><a href="#设计模式的分类" class="headerlink" title="设计模式的分类"></a>设计模式的分类</h3><p>创建型模式：通过提供创建对象的机制，增加已有代码的灵活性和可复用性</p>
<p>创建型有<strong>五</strong>种模式：工厂方法、抽象工厂、建造者、原型、单例</p>
<p>结构型模式：如何将对象和类组装成较大的结构，同时保持结构的灵活和高效</p>
<p>结构型有<strong>七</strong>种模式：适配器、桥接、组合、装饰、外观、享元、代理</p>
<p>行为型模式：负责对象间的高效沟通和职责委派</p>
<p>行为型有<strong>十一</strong>种模式：责任链、命令、迭代器、解释器、中介者、备忘录、观察者、状态、策略、模板方法、访问者</p>
<p>现在我们对设计模式有了初步认识，下面我们对每一种设计模式进行详细了解，并逐一举例</p>
<p>PS：本文缓慢更新（<del>当你看到这句话的时候表明没有更新完</del>），更新顺序会参考我们平时的使用频率以及重要程度随缘更新 项目源代码：<a target="_blank" rel="noopener" href="https://github.com/Soora33/design_patterns">sora33 - 设计模式</a></p>
<h2 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a>创建型</h2><h3 id="单例模式（Singleton）"><a href="#单例模式（Singleton）" class="headerlink" title="单例模式（Singleton）"></a>单例模式（Singleton）</h3><p>单例模式是设计模式中最简单也是最好理解的一个模式，它确保一个类只有一个实例，并且这个实例对外开放，可以被其他类调用使用。单例的核心在于如何<code>创建单例</code>，创建单例的方式常用的有 4 种，这里因为篇幅原因仅使用<code>静态内部类</code>的方式来实现单例，因为它保证了懒加载并且避免了同步开销。想知道其他 3 种创建方式和进一步了解单例的可以查看这篇文章：<a href="https://33sora.com/posts/59324e24.html">手写单例模式以及保证安全性</a></p>
<p>首先我们先来看一下使用静态内部类实现单例的代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例创建对象 音乐类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Music</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有化构造方法，防止外部实例化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Music</span><span class="params">()</span> {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Handler</span> {</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Music</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Music</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Music <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> Handler.INSTANCE;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Music</span> <span class="variable">music1</span> <span class="operator">=</span> Music.getInstance();</span><br><span class="line">        <span class="type">Music</span> <span class="variable">music2</span> <span class="operator">=</span> Music.getInstance();</span><br><span class="line">        System.out.println(music1);</span><br><span class="line">        System.out.println(music2);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> com.sora.Music@72ea2f77</span><br><span class="line"> com.sora.Music@72ea2f77</span><br></pre></td></tr></tbody></table></figure>

<p>我们以音乐类举例，需要私有化构造方法，防止外部创建对象。继续在内部创建一个静态内部类，我们都知道<strong>静态成员</strong>（如静态变量和静态方法）随着类的加载而加载，而静态内部类的加载是<strong>延迟的</strong>，只有在被显式调用时才会加载。因此，静态内部类不仅实现了懒加载，而且避免了同步开销，同时又保证了线程安全。</p>
<p>这里继续说点跟单例相关的几个问题，感兴趣的可以看看：</p>
<p>在 Spring 框架中，Bean 默认是单例的，这是基于 <strong>Spring 容器级别</strong>的单例，它的生命周期和 Spring 容器生命周期绑定，而我们通过 Java 创建的单例对象则是 <strong>JVM 级别</strong>，会在整个应用程序的 JVM 生命周期内存在。</p>
<p>Spring 中，我们可以通过 **@Scope (“Prototype”)** 将默认的单例创建改为原型创建。还有 request、session 等，这些都用的不多</p>
<p>使用单例对象时，我们的重点肯定是线程安全性。假设我们有一个类负责累加一个数并且返回，如果此时多个线程都调用了这个类，而这个类又是由 Spring 管理且是单例的，那么 Spring 如何保证线程安全呢？答案是 Spring 并不会保证多线程下的线程安全。因此多线程环境下，如果该单例对象存在可变状态，就需要我们手动处理线程安全问题，常见的几种方法如下：</p>
<pre><code>1. 无状态设计：无状态表示该对象不包含任何可变的实例对象，每次调用方法时，所有操作都依赖参数进行处理
2. 使用局部变量：如果我们要保存一个临时结果，不要使用全局变量！使用**局部变量**！因为局部变量是线程私有的，线程之间不会共享。
3. ThreadLocal：ThreadLocal为每一个线程都提供了一个副本，实现了线程间的隔离
4. 如果这个类必须要使用全局变量保存一些数据，那么必须使用线程安全的类，例如**ConcurrentHashMap**
</code></pre>
<p>适用场景：缓存类的实现、线程池管理、全局 ID 生成器、数据库连接池等等</p>
<h3 id="工厂方法（Factory-Method）"><a href="#工厂方法（Factory-Method）" class="headerlink" title="工厂方法（Factory Method）"></a>工厂方法（Factory Method）</h3><p>在讲解工厂方法之前，我们先来了解一下简单工厂，简单工厂是由一个接口、多个接口实现类以及一个工厂类组成，我们以游戏平台举例，平台就是一个接口，而 Steam、Epic 等就是具体的实现类，工厂类则是负责创建实现类的地方。我们具体来看代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Platform</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Epic</span> <span class="keyword">implements</span> <span class="title class_">Platform</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"我是Epic平台"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Origin</span> <span class="keyword">implements</span> <span class="title class_">Platform</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"我是橘子平台"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三个实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Steam</span> <span class="keyword">implements</span> <span class="title class_">Platform</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"我是Steam平台"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GamePlatform</span> {</span><br><span class="line">    <span class="keyword">public</span> Platform <span class="title function_">getPlatform</span><span class="params">(String platform)</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"Epic"</span>.equalsIgnoreCase(platform)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Epic</span>();</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"Steam"</span>.equalsIgnoreCase(platform)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Steam</span>();</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"Origin"</span>.equalsIgnoreCase(platform)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Origin</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用简单工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> <span class="string">"steam"</span>;</span><br><span class="line">        <span class="comment">// 创建工厂类实例</span></span><br><span class="line">        <span class="type">GamePlatform</span> <span class="variable">gamePlatform</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GamePlatform</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Platform</span> <span class="variable">steam</span> <span class="operator">=</span> gamePlatform.getPlatform(param);</span><br><span class="line">        steam.print();</span><br><span class="line">        param = <span class="string">"epic"</span>;</span><br><span class="line">        <span class="type">Platform</span> <span class="variable">epic</span> <span class="operator">=</span> gamePlatform.getPlatform(param);</span><br><span class="line">        epic.print();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 我是Steam平台</span><br><span class="line"> 我是Epic平台</span><br></pre></td></tr></tbody></table></figure>

<p>如果我们不使用简单工厂来完成这个案例，我们会直接 new Steam (), new Epic () 来完成对象的创建，那我们为什么要把创建对象的任务交给工厂类呢？因为简单工厂提供了<strong>解耦、维护性和灵活性</strong>。如果我们不使用简单工厂，那么当一个对象的构造逻辑发生改变，例如需要传入一些固定参数，我们需要在每一个用到的地方去修改并测试，但如果是简单工厂，我们直接在工厂类内进行修改即可，这便是解耦和维护。灵活性则表现在扩展，如果后续我们需要新加平台，没有使用简单工厂的情况下，我们需要去每一个地方去手动新增一个平台，而简单工厂只需要新增一个实现类，随后在工厂类内新加一个条件即可，通过参数来控制工厂类获取的具体实现对象。但这样破坏了开闭原则（对扩展开放，对修改关闭），所以工厂方法就这样出来了。</p>
<p>工厂方法在简单工厂的基础上做了一些修改，将原本一个工厂拆开了，每个对象都有属于自己的工厂。工厂方法共有四个角色：</p>
<ol>
<li>产品接口：定义所有产品的行为</li>
<li>产品实现类：实现产品接口，负责具体的产品实现</li>
<li>抽象工厂：所有工厂实现类的父类，声明返回产品对象的工厂方法，返回值必须是<strong>产品接口</strong></li>
<li>工厂实现类：继承抽象工厂类，重写返回产品对象工厂的方法，使其返回不同类型的产品</li>
</ol>
<p>下面我们以创建不同的支付对象举例，代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Pay</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支付宝支付类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPay</span> <span class="keyword">implements</span> <span class="title class_">Pay</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"用户使用AliPay支付，开始执行具体逻辑……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信支付类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPay</span> <span class="keyword">implements</span> <span class="title class_">Pay</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"用户使用微信支付，开始执行具体逻辑……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>到目前为止都是跟简单工厂一样，工厂部分可以看到阿里云和微信都有对应的工厂且继承了一个抽象类，这个抽象类就是负责声明一个创建工厂的方法。具体工厂代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付工厂 所以支付对象工厂都要继承 相当于父类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">PayFactory</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Pay <span class="title function_">getPayType</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 阿里云支付工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayFactory</span> <span class="keyword">extends</span> <span class="title class_">PayFactory</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Pay <span class="title function_">getPayType</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AliPay</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信支付工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayFactory</span> <span class="keyword">extends</span> <span class="title class_">PayFactory</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Pay <span class="title function_">getPayType</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WechatPay</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>之后通过参数来控制工厂的创建并调用支付方法，以后要新增支付方法，只需要实现一个新的支付类，创建一个新的支付工厂即可，解决了简单工厂的弊端（新增内容需要修改工厂类），符合开闭原则。下面是具体的客户端代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 支付参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> <span class="string">"ali"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">PayFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"wechat"</span>.equals(param)) {</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">WechatPayFactory</span>();</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"ali"</span>.equals(param)) {</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">AliPayFactory</span>();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">Pay</span> <span class="variable">payType</span> <span class="operator">=</span> factory.getPayType();</span><br><span class="line">        payType.pay();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 用户使用AliPay支付，开始执行具体逻辑……</span><br></pre></td></tr></tbody></table></figure>

<p>适用场景：开发与线上环境的快速切换，数据库连接类型，多类型文件生成与读取等等</p>
<h3 id="建造者（Builder）"><a href="#建造者（Builder）" class="headerlink" title="建造者（Builder）"></a>建造者（Builder）</h3><p>建造者模式更注重构建对象的这个过程，通过分步创建一个复杂的对象，将产品的创建与产品的本身进行分离，构建的过程就可以获得不同的对象。在代码中使用链式调用，方便的同时增加了可读性。我们一般通过建造者模式来创建那些有非传参数的对象或者参数过多的对象。</p>
<p>相信大家肯定见过类似于下面这样的代码，一个类的构造函数有多个可选参数，为了保证正常调用会写多个方法来进行重载，在这种情况下，我们就可以使用建造者的设计模式来完成。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> {</span><br><span class="line">    Computer(String cpu) { …… }</span><br><span class="line">    Computer(String cpu, String gpu) { …… }</span><br><span class="line">    Computer(String cpu, String gpu, String board) { …… }</span><br></pre></td></tr></tbody></table></figure>

<p>这里我们假设 cpu、gpu、board 和 arm 是必传参数。使用建造者模式：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> {</span><br><span class="line">    <span class="keyword">private</span> String cpu;</span><br><span class="line">    <span class="keyword">private</span> String gpu;</span><br><span class="line">    <span class="keyword">private</span> String board;</span><br><span class="line">    <span class="keyword">private</span> String arm;</span><br><span class="line">    <span class="keyword">private</span> String ssd;</span><br><span class="line">    <span class="keyword">private</span> String power;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">(ComputerBuilder computerBuilder)</span> {</span><br><span class="line">        <span class="built_in">this</span>.cpu = computerBuilder.cpu;</span><br><span class="line">        <span class="built_in">this</span>.gpu = computerBuilder.gpu;</span><br><span class="line">        <span class="built_in">this</span>.board = computerBuilder.board;</span><br><span class="line">        <span class="built_in">this</span>.arm = computerBuilder.arm;</span><br><span class="line">        <span class="built_in">this</span>.ssd = computerBuilder.ssd;</span><br><span class="line">        <span class="built_in">this</span>.power = computerBuilder.power;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ComputerBuilder</span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String cpu;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String gpu;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String board;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String arm;</span><br><span class="line">        <span class="keyword">private</span> String ssd;</span><br><span class="line">        <span class="keyword">private</span> String power;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ComputerBuilder</span><span class="params">(String cpu, String gpu, String board, String arm)</span> {</span><br><span class="line">            <span class="built_in">this</span>.cpu = cpu;</span><br><span class="line">            <span class="built_in">this</span>.gpu = gpu;</span><br><span class="line">            <span class="built_in">this</span>.board = board;</span><br><span class="line">            <span class="built_in">this</span>.arm = arm;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ComputerBuilder <span class="title function_">setSsd</span><span class="params">(String ssd)</span> {</span><br><span class="line">            <span class="built_in">this</span>.ssd = ssd;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ComputerBuilder <span class="title function_">setPower</span><span class="params">(String power)</span> {</span><br><span class="line">            <span class="built_in">this</span>.power = power;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Computer <span class="title function_">build</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Computer</span>(<span class="built_in">this</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Computer{"</span> +</span><br><span class="line">                <span class="string">"cpu='"</span> + cpu + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", gpu='"</span> + gpu + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", board='"</span> + board + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", arm='"</span> + arm + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", ssd='"</span> + ssd + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", power='"</span> + power + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computerBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span></span><br><span class="line">                .ComputerBuilder(<span class="string">"7800X3D"</span>, <span class="string">"7900xtx"</span>, <span class="string">"B650M"</span>, <span class="string">"32G"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computerBuilder2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span></span><br><span class="line">                .ComputerBuilder(<span class="string">"7800X3D"</span>, <span class="string">"7900xtx"</span>, <span class="string">"B650M"</span>, <span class="string">"32G"</span>)</span><br><span class="line">                .setSsd(<span class="string">"2T"</span>)</span><br><span class="line">                .setPower(<span class="string">"1000w"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(computerBuilder);</span><br><span class="line">        System.out.println(computerBuilder2);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> Computer{cpu=<span class="string">'7800X3D'</span>, gpu=<span class="string">'7900xtx'</span>, board=<span class="string">'B650M'</span>, arm=<span class="string">'32G'</span>, ssd=<span class="string">'null'</span>, power=<span class="string">'null'</span>}</span><br><span class="line"> Computer{cpu=<span class="string">'7800X3D'</span>, gpu=<span class="string">'7900xtx'</span>, board=<span class="string">'B650M'</span>, arm=<span class="string">'32G'</span>, ssd=<span class="string">'2T'</span>, power=<span class="string">'1000w'</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>电脑类的所有属性都要经过 ComputerBuilder 来完成，并且在内部配置了必选参数和可选参数，必选参数保证了对象创建的完整性同时避免了构造函数爆炸的情况，可选参数带来了扩展性与灵活性，可以随时新增字段而不影响现有代码，链式调用又直观体现了该对象的整体结构</p>
<p>适用场景：复杂对象的创建，数据库连接参数配置，http 连接参数的配置等等</p>
<h3 id="抽象工厂（Abstract-Factory）"><a href="#抽象工厂（Abstract-Factory）" class="headerlink" title="抽象工厂（Abstract Factory）"></a>抽象工厂（Abstract Factory）</h3><p>在讲抽象工厂前<strong>强烈建议</strong>先把工厂方法搞明白，会好理解很多。下面我们开始学习抽象工厂。</p>
<p>学习抽象工厂前我们要先了解 2 个概念，<strong>产品族</strong>和<strong>产品等级结构</strong></p>
<p><strong>产品族</strong>：是指一组相关联的产品，它们一起协作或具有某种共同属性。以麦当劳举例，麦当劳生产的汉堡、薯条、可乐可以被看作一个产品族，所有这些产品都属于麦当劳的风格。</p>
<p><strong>产品等级结构</strong>：指产品的不同种类或类型的层次关系。比如，汉堡、薯条、饮料这些都是 “快餐产品” 的不同类型，它们代表了产品的不同等级结构。</p>
<p>下面继续说说抽象工厂的角色，总体上，抽象工厂的角色与工厂方法类似，但具体的职责会有点不同：</p>
<ul>
<li>工厂方法侧重为<strong>单个产品</strong>提供接口，每个工厂只会生产一个产品</li>
<li>抽象工厂则为<strong>产品族</strong>提供接口，每个工厂可以生产同一产品族下的所有产品类型</li>
</ul>
<p>抽象工厂中主要有以下角色：</p>
<ol>
<li>产品接口：为每种产品声明接口</li>
<li>产品实现类：实现产品接口，负责具体的产品实现</li>
<li>抽象工厂：所有工厂实现类的父类，声明创建了一系列相关产品的接口</li>
<li>工厂实现类：继承抽象工厂类，负责创建具体的产品</li>
</ol>
<p><strong>抽象工厂模式</strong>的核心思想是<strong>为产品族提供一个创建接口</strong>。一个工厂不但负责创建一类产品（比如汉堡），还要为同一个产品族中的其他相关产品提供创建方式（如薯条、饮料）。通过抽象工厂模式，我们可以根据具体的需求生成同一产品族中的相关产品，而不必关心每个产品的具体实现细节，同时也隔离了具体类，客户端只通过接口来与产品交互，不直接依赖具体产品类，做到了解耦的同时增强了扩展性。但缺点同样是因为高扩展性，我们新增一个产品等级结构时，需要修改抽象工厂类以及各个工厂的具体实现。</p>
<p>下面以游戏开发商举例，每个游戏开发商都会开发不同类型的游戏，比如 RPG（角色扮演）、ACT（动作）等，这些不同的游戏类型属于<strong>产品等级结构</strong>。而多个游戏开发商，如卡普空、索尼等，都能够开发这些类型的游戏，这些开发商则可以看作是<strong>产品族</strong>的不同实现。我们以卡普空公司为例，创建这两种类型的游戏：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动作类游戏接口 （字段：游戏名、游戏详情、上手难度）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ACT</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">details</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">level</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 角色扮演类游戏接口 （字段：游戏名、游戏详情）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RPG</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">details</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 卡普空的动作类游戏具体实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonsterHunter</span> <span class="keyword">implements</span> <span class="title class_">ACT</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏：怪物猎人"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">details</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏介绍：在怪物猎人的世界中，你将扮演一名猎人在新大陆上……"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">level</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"上手难度：★★★★☆"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 卡普空的角色扮演类游戏具体实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResidentEvil</span> <span class="keyword">implements</span> <span class="title class_">RPG</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏：生化危机"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">details</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏介绍：里昂接到总统特令，负责去孤岛上寻找阿什莉并将其救出，在岛上……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂类 声明所有的产品等级结构</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">GameFactory</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> ACT <span class="title function_">createACTGame</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> RPG <span class="title function_">createRPGGame</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建卡普空工厂，返回所有产品等级结构</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CapComFactory</span> <span class="keyword">extends</span> <span class="title class_">GameFactory</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ACT <span class="title function_">createACTGame</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MonsterHunter</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RPG <span class="title function_">createRPGGame</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResidentEvil</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">CapComFactory</span> <span class="variable">capComFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CapComFactory</span>();</span><br><span class="line">        System.out.println(<span class="string">"创建卡普空下的RPG游戏："</span>);</span><br><span class="line">        <span class="type">RPG</span> <span class="variable">capComRPGGame</span> <span class="operator">=</span> capComFactory.createRPGGame();</span><br><span class="line">        capComRPGGame.name();</span><br><span class="line">        capComRPGGame.details();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"\n创建卡普空下的ACT游戏："</span>);</span><br><span class="line">        <span class="type">ACT</span> <span class="variable">capComACTGame</span> <span class="operator">=</span> capComFactory.createACTGame();</span><br><span class="line">        capComACTGame.name();</span><br><span class="line">        capComACTGame.details();</span><br><span class="line">        capComACTGame.level();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 创建卡普空下的RPG游戏：</span><br><span class="line"> 游戏：生化危机</span><br><span class="line"> 游戏介绍：里昂接到总统特令，负责去孤岛上寻找阿什莉并将其救出，在岛上……</span><br><span class="line"></span><br><span class="line"> 创建卡普空下的ACT游戏：</span><br><span class="line"> 游戏：怪物猎人</span><br><span class="line"> 游戏介绍：在怪物猎人的世界中，你将扮演一名猎人在新大陆上……</span><br><span class="line"> 上手难度：★★★★☆</span><br></pre></td></tr></tbody></table></figure>

<p>在这个例子中，卡普空这个产品族为我们提供了两个产品等级结构的游戏：一个动作类（ACT）和一个角色扮演类（RPG）。通过抽象工厂，我们实现了不同类型游戏的创建。同时我们可以很容易地扩展另一个游戏开发商产品族：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 索尼的动作类游戏具体实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GodOfWar</span> <span class="keyword">implements</span> <span class="title class_">ACT</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏：战神"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">details</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏介绍：奎托斯与儿子成功将母亲的遗骨撒落在高山，但门外的男人究竟是……"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">level</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"上手难度：★★☆☆☆"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 索尼的角色扮演类游戏具体实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TheLastOfUs</span> <span class="keyword">implements</span> <span class="title class_">RPG</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"游戏：最后生还者"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">details</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"开发商：人类因现代传染病而面临绝种危机，当环境从废墟的都市再度自然化时……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建索尼工厂，返回所有产品等级结构</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SonyFactory</span> <span class="keyword">extends</span> <span class="title class_">GameFactory</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ACT <span class="title function_">createACTGame</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GodOfWar</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RPG <span class="title function_">createRPGGame</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TheLastOfUs</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">SonyFactory</span> <span class="variable">sonyFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SonyFactory</span>();</span><br><span class="line">        System.out.println(<span class="string">"\n创建索尼下的RPG游戏："</span>);</span><br><span class="line">        <span class="type">RPG</span> <span class="variable">sonyRPGGame</span> <span class="operator">=</span> sonyFactory.createRPGGame();</span><br><span class="line">        sonyRPGGame.name();</span><br><span class="line">        sonyRPGGame.details();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"\n创建索尼下的ACT游戏："</span>);</span><br><span class="line">        <span class="type">ACT</span> <span class="variable">sonyACTGame</span> <span class="operator">=</span> sonyFactory.createACTGame();</span><br><span class="line">        sonyACTGame.name();</span><br><span class="line">        sonyACTGame.details();</span><br><span class="line">        sonyACTGame.level();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 创建索尼下的RPG游戏：</span><br><span class="line"> 游戏：最后生还者</span><br><span class="line"> 开发商：人类因现代传染病而面临绝种危机，当环境从废墟的都市再度自然化时……</span><br><span class="line"></span><br><span class="line"> 创建索尼下的ACT游戏：</span><br><span class="line"> 游戏：战神</span><br><span class="line"> 游戏介绍：奎托斯与儿子成功将母亲的遗骨撒落在高山，但门外的男人究竟是……</span><br><span class="line"> 上手难度：★★☆☆☆</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到，我们只需要在产品接口的基础上，完成对索尼产品的具体实现，并新增一个索尼工厂，即可获得索尼产品族下的所有产品。也就是对于扩展性而言，新增一个产品族非常简单，没有破坏开闭原则，而当新增产品等级结构时，需要修改现有的抽象工厂类以及工厂类的实现会破坏开闭原则。</p>
<p>适用场景：系统需要与多个产品族进行交互（例如 windows 与 mac、跨平台应用）</p>
<h3 id="原型模式（Prototype）"><a href="#原型模式（Prototype）" class="headerlink" title="原型模式（Prototype）"></a>原型模式（Prototype）</h3><p>原型模式的核心是使用现有对象作为模板，通过克隆的方式创建新的对象。一般当创建对象的开销比较大或者对象结构比较复杂时，会使用原型模式，通过 clone 方法来实现对象的复制，同样我们也可以自己选择实现方式是浅拷贝还是深拷贝，下面是原型模式的角色：</p>
<ol>
<li><strong>原型接口</strong>：定义克隆方法，所有具体原型类都要实现这个接口</li>
<li><strong>具体原型类</strong>：实现原型接口，具体定义了如何复制自身</li>
</ol>
<p>这里再提一嘴深拷贝和浅拷贝：</p>
<ul>
<li><p>深拷贝：复制对象以及引用类型的数据，克隆出的对象与原对象完全独立，互不影响</p>
</li>
<li><p>浅拷贝：只复制对象的基本数据类型，引用数据类型的<strong>引用</strong>，克隆出的对象和原对象共享同一个引用地址</p>
</li>
</ul>
<p>如果我们使用浅拷贝，修改任一对象里的对象或集合，另一个也会发生改变，因为这个对象都指向同一个地址。</p>
<p>PS：String 数据类型也是引用类型的数据，但因为底层是不可变的数组，所以我们修改其中一个对象另一个并不会发生改变。所以对于 String 类型，我们可以放心使用，因为任何<strong>修改</strong>本质上都是创建了新的对象</p>
<p>下面我们来看原型模式的示例代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原型接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Prototype</span> {</span><br><span class="line">    Prototype <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Album</span> <span class="keyword">implements</span> <span class="title class_">Prototype</span> {</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String sings;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Album</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List <span class="title function_">getList</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Album{"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sings='"</span> + sings + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", list="</span> + list +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Album</span><span class="params">(String name, String sings, ArrayList&lt;String&gt; list)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sings = sings;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 克隆实现（浅拷贝）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Prototype <span class="title function_">clone</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Album</span>(<span class="built_in">this</span>.name, <span class="built_in">this</span>.sings, <span class="built_in">this</span>.list);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>原型模式的使用很简单，只需要一个原型接口即可，内部包含一个 <code>clone</code> 方法，具体实现深拷贝还是浅拷贝则由原型类决定。这里我克隆 Album 类，实现原型接口后，在 <code>clone</code> 方法内创建一个新对象并填充数据返回，这样的方式是浅拷贝。我们来看一下浅拷贝的结果：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Album</span> <span class="variable">album</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Album</span>(<span class="string">"透明な君を掬う"</span>, <span class="string">"nayuta"</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>(){{</span><br><span class="line">            add(<span class="string">"透明な君"</span>);</span><br><span class="line">            add(<span class="string">"誰そ彼"</span>);</span><br><span class="line">            add(<span class="string">"追慕"</span>);</span><br><span class="line">            add(<span class="string">"僕が見つけた綻び"</span>);</span><br><span class="line">            add(<span class="string">"灰燼"</span>);</span><br><span class="line">            add(<span class="string">"彼は誰"</span>);</span><br><span class="line">            add(<span class="string">"君を掬う"</span>);</span><br><span class="line">        }});</span><br><span class="line">        System.out.println(<span class="string">"原对象：："</span> + album);</span><br><span class="line">        <span class="type">Album</span> <span class="variable">clone</span> <span class="operator">=</span> (Album) album.clone();</span><br><span class="line">        System.out.println(<span class="string">"克隆对象："</span> + clone);</span><br><span class="line">        System.out.println(<span class="string">"修改克隆对象，删掉最后一首歌曲……"</span>);</span><br><span class="line">        clone.getList().removeLast();</span><br><span class="line">        System.out.println(<span class="string">"原对象："</span> + album);</span><br><span class="line">        System.out.println(<span class="string">"克隆对象："</span> + clone);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 原对象：：Album{name=<span class="string">'透明な君を掬う'</span>, sings=<span class="string">'nayuta'</span>, list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰, 君を掬う]}</span><br><span class="line"> 克隆对象：Album{name=<span class="string">'透明な君を掬う'</span>, sings=<span class="string">'nayuta'</span>, list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰, 君を掬う]}</span><br><span class="line"> 修改克隆对象，删掉最后一首歌曲……</span><br><span class="line"> 原对象：Album{name=<span class="string">'透明な君を掬う'</span>, sings=<span class="string">'nayuta'</span>, list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰]}</span><br><span class="line"> 克隆对象：Album{name=<span class="string">'透明な君を掬う'</span>, sings=<span class="string">'nayuta'</span>, list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰]}</span><br></pre></td></tr></tbody></table></figure>

<p>我们删除克隆对象集合的一个数据后，原对象也发生了相应的变更，因为他们的使用的 <strong>list</strong> 实际上是一个。如果要实现深拷贝，需要将原型类中的 <code>clone</code> 方法需要改成这样：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里我通过序列化和反序列化的方式实现了深拷贝，但注意对象必须实现 Serializable 接口</span></span><br><span class="line"><span class="comment">// 克隆实现（深拷贝）</span></span><br><span class="line"><span class="keyword">public</span> Prototype <span class="title function_">clone</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">            oos.writeObject(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis);</span><br><span class="line">            <span class="keyword">return</span> (Prototype) ois.readObject();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException | ClassNotFoundException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>改为深拷贝后，只有克隆对象的集合数据发生了改变，原对象的集合并没有收到影响，这就是深拷贝和浅拷贝的区别</p>
<figure class="highlight tex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原对象：：Album{name='透明な君を掬う', sings='nayuta', list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰, 君を掬う]}</span><br><span class="line">克隆对象：Album{name='透明な君を掬う', sings='nayuta', list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰, 君を掬う]}</span><br><span class="line">修改克隆对象，删掉最后一首歌曲……</span><br><span class="line">原对象：Album{name='透明な君を掬う', sings='nayuta', list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰, 君を掬う]}</span><br><span class="line">克隆对象：Album{name='透明な君を掬う', sings='nayuta', list=[透明な君, 誰そ彼, 追慕, 僕が見つけた綻び, 灰燼, 彼は誰]}</span><br></pre></td></tr></tbody></table></figure>

<p>适用场景：需要大量创建的对象、缓存对象的创建、复杂商品 / 报表模板的生成等等</p>
<h2 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a>结构型</h2><h3 id="适配器（Adapter）"><a href="#适配器（Adapter）" class="headerlink" title="适配器（Adapter）"></a>适配器（Adapter）</h3><p>适配器模式用于将一个类的接口转为期望的一个接口，来使原本不兼容的接口可以正常工作，适配器的核心是为现有类提供一个兼容的接口，解决接口不兼容的问题，而不需要修改原有代码。</p>
<p>适配器主要有三个角色，分别是<strong>目标接口、被适配类、适配器类</strong>。</p>
<ol>
<li>目标接口：客户端所期望的接口，也就是客户想要的数据类型</li>
<li>被适配类：需要被适配的类，且这个类目前无法直接转为目标接口</li>
<li>适配器类：实现目标接口，将被适配类转为目标接口，从而让客户端和被适配类完美工作</li>
</ol>
<p>下面我以货币间转换来举例，我们现在有 2 个货币类，日元类和人民币类，日元类将输入的金额转为美元、人民币类则直接返回输入的金额。如果需要将日元转为人民币，那么目标接口就是<strong>人民币类（因为我们的目标是返回人民币）</strong>、被适配类是<strong>日元类（目前日元功能是转为美元，不符合我们需求，所以需要被适配）</strong>，<strong>适配器类（进行具体转换的类）</strong>就是我们新建的类。具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 人民币类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cny</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double rmb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Cny</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Cny</span><span class="params">(Double rmb)</span> {</span><br><span class="line">        <span class="built_in">this</span>.rmb = rmb;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getRmb</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> rmb;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日元类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jpy</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double jpy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Jpy</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Jpy</span><span class="params">(Double jpy)</span> {</span><br><span class="line">        <span class="built_in">this</span>.jpy = jpy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getJpy</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> jpy / <span class="number">144.33</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpyToCnyAdapter</span> <span class="keyword">extends</span> <span class="title class_">Cny</span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jpy jpy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JpyToCnyAdapter</span><span class="params">(Jpy jpy)</span> {</span><br><span class="line">        <span class="built_in">this</span>.jpy = jpy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getRmb</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">Double</span> <span class="variable">result</span> <span class="operator">=</span> jpy.getJpy() * <span class="number">7.05</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Double</span> <span class="variable">price</span> <span class="operator">=</span> <span class="number">100.00</span>;</span><br><span class="line">        <span class="type">Cny</span> <span class="variable">cny</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cny</span>(price);</span><br><span class="line">        System.out.println(<span class="string">"人民币类输入金额："</span> + price + <span class="string">" ，返回："</span> + cny.getRmb());</span><br><span class="line"></span><br><span class="line">        <span class="type">Jpy</span> <span class="variable">jpy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jpy</span>(<span class="number">100.00</span>);</span><br><span class="line">        System.out.println(<span class="string">"日元类输入金额："</span> + price + <span class="string">" ，返回："</span> + jpy.getJpy());</span><br><span class="line"></span><br><span class="line">        <span class="type">JpyToCnyAdapter</span> <span class="variable">cnyAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JpyToCnyAdapter</span>(jpy);</span><br><span class="line">        System.out.println(<span class="string">"适配器类输入金额："</span> + price + <span class="string">" ，返回："</span> + cnyAdapter.getRmb());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 人民币类输入金额：<span class="number">100.0</span> ，返回：<span class="number">100.0</span></span><br><span class="line"> 日元类输入金额：<span class="number">100.0</span> ，返回：<span class="number">0.6928566479595372</span></span><br><span class="line"> 适配器类输入金额：<span class="number">100.0</span> ，返回：<span class="number">4.884639368114737</span></span><br></pre></td></tr></tbody></table></figure>

<p>对于适配器类，我们一般记住，实现 / 继承的是目标接口、将被适配类引入并获取结果对其转换。</p>
<p>下面再来看一个例子，new Thread () 接受的参数是 Runnable 类型，那如何支持 Callable 类型的任务呢，同样新建一个适配器接口即可。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Callable接口的任务 不可以作为new Thread的参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(<span class="string">"callable执行成功"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器类，实现Runnable接口，并将callable的任务引入，在run方法内执行</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunnableAdapter</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Callable callable;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RunnableAdapter</span><span class="params">(Callable myCallable)</span> {</span><br><span class="line">        <span class="built_in">this</span>.callable = myCallable;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            callable.call();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Callable</span> <span class="variable">callable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleCallable</span>();</span><br><span class="line">        <span class="comment">// callable不可以作为Thread的参数</span></span><br><span class="line">				<span class="comment">// Thread thread = new Thread(callable);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过适配器将其转为Runnable</span></span><br><span class="line">        <span class="type">RunnableAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RunnableAdapter</span>(callable);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(adapter);</span><br><span class="line">        thread.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们的目标是将 Callable 转为 Runnable，所以目标接口是 Runnable，将被适配的类引入，进行逻辑重写，这里我们仅仅调用 call 方法即可。随后 Callable 类型的接口，经过适配器转换就可以变为 Runnable 类型的接口。</p>
<p>这就是适配器模式，适配器在我们的代码中有很多表现形式，这里也仅仅是冰山一角，但其核心思想是将不兼容的对象变为兼容的对象。</p>
<p>适用场景：第三方库的兼容、多格式文件转为统一格式、多日志集成等等</p>
<h3 id="外观（Facade）"><a href="#外观（Facade）" class="headerlink" title="外观（Facade）"></a>外观（Facade）</h3><p>外观模式也叫门面模式，通过提供一个简单的接口，将复杂的子系统包装起来，简化了客户端与复杂系统之间的交互，隐藏了内部细节。外观模式有 2 个角色，分别是外观类和子系统类，<strong>外观类</strong>负责提供统一的外部接口调用，调用各个子系统的功能。<strong>子系统类</strong>则是负责实现系统的具体功能，被外观类调用。下面以用户查看订单为例完成一个外观模式：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">logic</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取订单编号类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNumber</span> <span class="keyword">implements</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logic</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"订单编号：1097361294729"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取订单价格类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPrice</span> <span class="keyword">implements</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logic</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"订单金额：1020元"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取订单名称类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderShop</span> <span class="keyword">implements</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logic</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"订单商品名：TouHou Remilia card"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FacadeOrder</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OrderNumber orderNumber;</span><br><span class="line">    <span class="keyword">private</span> OrderPrice orderPrice;</span><br><span class="line">    <span class="keyword">private</span> OrderShop orderShop;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FacadeOrder</span><span class="params">()</span> {</span><br><span class="line">        orderNumber = <span class="keyword">new</span> <span class="title class_">OrderNumber</span>();</span><br><span class="line">        orderPrice = <span class="keyword">new</span> <span class="title class_">OrderPrice</span>();</span><br><span class="line">        orderShop = <span class="keyword">new</span> <span class="title class_">OrderShop</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getNumber</span><span class="params">()</span> {</span><br><span class="line">        orderNumber.logic();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getShop</span><span class="params">()</span> {</span><br><span class="line">        orderShop.logic();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        orderPrice.logic();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">FacadeOrder</span> <span class="variable">facadeOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FacadeOrder</span>();</span><br><span class="line">        facadeOrder.getShop();</span><br><span class="line">        facadeOrder.getNumber();</span><br><span class="line">        facadeOrder.getPrice();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 订单商品名：TouHou Remilia card</span><br><span class="line"> 订单编号：<span class="number">1097361294729</span></span><br><span class="line"> 订单金额：<span class="number">1020</span>元</span><br></pre></td></tr></tbody></table></figure>

<p>其实很简单，外观模式就是对多个类的操作进行了封装，将原本需要调用 3 个或更多接口的操作统一封装到了一个类里，我们只需要对外暴露出外观类即可，这样调用方只需要调用一个接口就可以完成之前需要调用多个不同的接口才能完成的功能。减少了客户端与子系统之间的耦合，不过要注意不要过多的使用外观模式，否则系统反而失去了模块化的优势。</p>
<p>适用场景：用户下单、多支付场景集成、需要对外提供一个统一接口且内部实现比较复杂等等</p>
<h3 id="代理（Proxy）"><a href="#代理（Proxy）" class="headerlink" title="代理（Proxy）"></a>代理（Proxy）</h3><p>代理模式的核心思想是不直接操作原对象，而是通过代理类来完成操作，这样就可以在不改变原对象的前提下，加入额外的功能。举个例子，我们平时买房时，可以选择找中介，中介会在了解我们的要求后给出几个合适的房子供我们选择，其中，中介作为代理，替我们完成了筛选房子的过程。这就是代理模式的作用，不接触真实对象（各式各样的房源）的前提下，通过代理提供额外操作（筛选房子的过程）。带来的好处就是解耦，通过代理对象来去做与核心业务无关的功能。</p>
<p>代理在 Java 中可以分为两种，<code>静态代理</code>和<code>动态代理</code>，其中动态代理又包含 <code>JDK代理和CGLIB代理</code>。</p>
<p><strong>静态代理和动态代理的区别：</strong></p>
<p>静态代理在编译时就确定类，由我们手动实现的，所以目标类越多，我们需要写的代码就越多，灵活性就差了，导致维护成本高。动态代理则是在运行时生成代理类，不需要我们手动编写，因为是基于反射和字节码，我们只需要写一个动态代理类即可完成所有类的代理。但因为用到了反射，所以性能没有静态代理高。</p>
<p><strong>JDK 动态代理和 CGLIB 代理的区别：</strong></p>
<p>JDK 动态代理是基于 Java 反射机制，仅能代理实现了接口的类；CGLIB 动态代理是基于字节码生成，可以代理没有实现接口的类。在效率方面，方法多的情况下，CGLIB 的效率会比较高，但一般会选择 JDK 动态代理，除非没有实现接口。</p>
<p>在代理模式中，有三个角色，<strong>抽象主题</strong>、<strong>真实主题</strong>和<strong>代理类</strong>。</p>
<ol>
<li>抽象主题：一个公共接口，真实主题和代理类都要实现这个接口</li>
<li>真实主题：实现抽象主题，处理真实的逻辑</li>
<li>代理类：实现抽象主题，引入真实主题，并在执行真实主题前后、进行额外操作</li>
</ol>
<p>下面我会针对这三个代理模式进行演示：</p>
<p><strong>静态代理：</strong></p>
<p>下面我以代理播放器为例，播放器是用来播放媒体的，我们在代理类中加入一些解码编码的额外操作。具体代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Media</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 播放器（真实主题）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">implements</span> <span class="title class_">Media</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"正在播放媒体……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理播放器（代理类）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlayerProxy</span> <span class="keyword">implements</span> <span class="title class_">Media</span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Player player;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"静态代理：加载解码器……"</span>);</span><br><span class="line">        <span class="keyword">if</span> (player == <span class="literal">null</span>) {</span><br><span class="line">            player = <span class="keyword">new</span> <span class="title class_">Player</span>();</span><br><span class="line">        }</span><br><span class="line">        player.play();</span><br><span class="line">        System.out.println(<span class="string">"静态代理：文件播放完成"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">PlayerProxy</span> <span class="variable">playerProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PlayerProxy</span>();</span><br><span class="line">        playerProxy.play();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 静态代理：加载解码器……</span><br><span class="line"> 正在播放媒体……</span><br><span class="line"> 静态代理：文件播放完成</span><br></pre></td></tr></tbody></table></figure>

<p>其实很简单，就是新建了一个类，引入了真实主题，并且在执行具体逻辑之前，额外加入一些操作。这就是静态代理，但每有一个需要代理的类，我们就要像这样手写一个代理类，很是麻烦，下面我们就来使用动态代理解决这个问题。</p>
<p><strong>动态代理：</strong></p>
<p><code>JDK代理：</code></p>
<p>jdk 代理仅支持实现了接口的类，这一点一定要注意！和静态代理相比，代理类是通过生成器生成的，我们需要将额外的操作写在生成器内，下面是具体代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Media</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">implements</span> <span class="title class_">Media</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"正在播放媒体……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类（由生成器生成）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JDKProxyHandler</span><span class="params">(Object target)</span> {</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        System.out.println(<span class="string">"JDK：加载解码器……"</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">"JDK：文件播放完成"</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建目标对象</span></span><br><span class="line">        <span class="type">Player</span> <span class="variable">player</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Player</span>();</span><br><span class="line">        <span class="comment">// 创建代理对象</span></span><br><span class="line">        <span class="type">Media</span> <span class="variable">playerProxy</span> <span class="operator">=</span> (Media)Proxy.newProxyInstance(</span><br><span class="line">                player.getClass().getClassLoader(), <span class="comment">// 类加载器</span></span><br><span class="line">                player.getClass().getInterfaces(), <span class="comment">// 目标接口</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">JDKProxyHandler</span>(player) <span class="comment">// 动态代理处理器</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 调用代理对象的方法</span></span><br><span class="line">        playerProxy.play();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> JDK：加载解码器……</span><br><span class="line"> 正在播放媒体……</span><br><span class="line"> JDK：文件播放完成</span><br></pre></td></tr></tbody></table></figure>

<p>在 JDK 代理中，通过 <code>Proxy.newProxyInstance</code> 动态生成的代理类是目标类实现接口的字类，会重写接口中的方法，所以实际上调用的是 <code>invoke</code> 方法，而非原本的目标方法。</p>
<p><code>CGLIB代理：</code></p>
<p>CGLIB 使用字节码增强目标类，所以对于不实现接口的类也可以用。Spring 中，如果目标类实现了接口，则使用 JDK 动态代理，没有实现接口则使用 CGLIB 代理。</p>
<p>使用 CGLIB 代理前，我们需要引入依赖。目前 CGLIB 已经停止维护，最新版本为 3.3.0，对于 Java17 以上的，由于增强了对反射的限制，还需要在启动行加上一段命令</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// Java17以上的需要在启动行加一段命令</span><br><span class="line">add-opens java.base/java.lang=ALL-UNNAMED</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Player</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"正在播放媒体……"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// CGLIB</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CGLIBProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CGLIBProxyHandler</span><span class="params">(Object target)</span> {</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">createProxy</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 创建增强器类</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">// 设置父类</span></span><br><span class="line">        enhancer.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">// 设置回调</span></span><br><span class="line">        enhancer.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        System.out.println(<span class="string">"CGLIB：加载解码器……"</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> methodProxy.invoke(target, objects);</span><br><span class="line">        System.out.println(<span class="string">"CGLIB：文件播放完成"</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建目标对象</span></span><br><span class="line">        <span class="type">Player</span> <span class="variable">player</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Player</span>();</span><br><span class="line">        <span class="comment">// 创建代理对象</span></span><br><span class="line">        <span class="type">CGLIBProxyHandler</span> <span class="variable">proxyHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CGLIBProxyHandler</span>(player);</span><br><span class="line">        <span class="type">Player</span> <span class="variable">proxy</span> <span class="operator">=</span> (Player) proxyHandler.createProxy();</span><br><span class="line">        <span class="comment">// 调用代理对象方法</span></span><br><span class="line">        proxy.play();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> CGLIB：加载解码器……</span><br><span class="line"> 正在播放媒体……</span><br><span class="line"> CGLIB：文件播放完成</span><br></pre></td></tr></tbody></table></figure>

<p>CGLIB 代理的代理类是目标类的子类，重写了目标类的非 final 方法，重写的方法调用了 <code>intercept</code> 方法，所以在调用代理对象方法时，会进入 <code>intercept</code> 方法内。</p>
<p>适用场景：权限控制、缓存代理、Spring 的 AOP 代理等等</p>
<h3 id="装饰器（Decorator）"><a href="#装饰器（Decorator）" class="headerlink" title="装饰器（Decorator）"></a>装饰器（Decorator）</h3><p>装饰器模式可以允许我们在不改变对象结构的情况下，动态地给对象添加功能。</p>
<p>装饰器模式的角色通常有四个，分别是<strong>抽象组件</strong>、<strong>具体组件</strong>、<strong>装饰器类</strong>、<strong>具体装饰器</strong>组成。其实这几个角色很好理解，用商品打折来举例的话，抽象组件就是一个商品接口，定义了商品的各种信息。具体组件则是商品的具体实现，例如牛奶、香蕉、咖啡等。装饰器类则表示需要对商品进行某些装饰（如打折）。具体装饰器是具体的折扣实现，比如是满减，还是打折。下面是角色之间的关系：</p>
<ol>
<li>抽象组件：一个抽象接口，是原始对象和装饰类的共同接口</li>
<li>具体组件：实现抽象组件接口</li>
<li>装饰器类：是一个抽象类且实现了抽象组件接口。持有一个抽象组件对象的引用。它不实现具体功能，而是提供了一个装饰器类的基础结构，我们可以以这个为基础扩展出多个具体装饰器类。</li>
<li>具体装饰器：继承装饰器类，提供功能扩展，比如在原始对象的基础上新增属性、加工一些数据等</li>
</ol>
<p>下面以购买一个商品，该商品可以使用折扣优惠、也可以使用优惠卷优惠为场景，具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Goods</span> {</span><br><span class="line">    String <span class="title function_">desc</span><span class="params">()</span>;</span><br><span class="line">    Double <span class="title function_">price</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Milk</span> <span class="keyword">implements</span> <span class="title class_">Goods</span> {</span><br><span class="line">    String desc;</span><br><span class="line">    Double price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Milk</span><span class="params">(String desc, Double price)</span> {</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desc</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">price</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">GoodsDecorator</span> <span class="keyword">implements</span> <span class="title class_">Goods</span> {</span><br><span class="line">    <span class="keyword">protected</span> Goods goods;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GoodsDecorator</span><span class="params">(Goods goods)</span> {</span><br><span class="line">        <span class="built_in">this</span>.goods = goods;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desc</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> goods.desc();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">price</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> goods.price();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优惠卷装饰器-具体装饰器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponDecorator</span> <span class="keyword">extends</span> <span class="title class_">GoodsDecorator</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double coupon;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CouponDecorator</span><span class="params">(Goods goods, Double coupon)</span> {</span><br><span class="line">        <span class="built_in">super</span>(goods);</span><br><span class="line">        <span class="built_in">this</span>.coupon = coupon;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desc</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> goods.desc() + <span class="string">", 直减: "</span> + coupon + <span class="string">"元"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">price</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> goods.price() - coupon;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 折扣装饰器-具体装饰器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiscountDecorator</span> <span class="keyword">extends</span> <span class="title class_">GoodsDecorator</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double discount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DiscountDecorator</span><span class="params">(Goods goods,Double discount)</span> {</span><br><span class="line">        <span class="built_in">super</span>(goods);</span><br><span class="line">        <span class="built_in">this</span>.discount = discount;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desc</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> goods.desc() + <span class="string">", 折扣力度: "</span> + discount  + <span class="string">"折"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">price</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> goods.price() * discount;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建一个商品并打印基础信息</span></span><br><span class="line">        <span class="type">Milk</span> <span class="variable">milk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Milk</span>(<span class="string">"牛奶"</span>, <span class="number">2.5</span>);</span><br><span class="line">        System.out.println(<span class="string">"商品基础信息："</span>);</span><br><span class="line">        System.out.println(milk.desc());</span><br><span class="line">        System.out.println(milk.price());</span><br><span class="line">        System.out.println(<span class="string">"===================="</span>);</span><br><span class="line">        <span class="comment">// 使用折扣装饰</span></span><br><span class="line">        <span class="type">DiscountDecorator</span> <span class="variable">discountDecorator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DiscountDecorator</span>(milk, <span class="number">0.75</span>);</span><br><span class="line">        System.out.println(<span class="string">"商品（折扣）信息："</span>);</span><br><span class="line">        System.out.println(discountDecorator.desc());</span><br><span class="line">        System.out.println(discountDecorator.price());</span><br><span class="line">        System.out.println(<span class="string">"===================="</span>);</span><br><span class="line">        <span class="comment">// 使用优惠券装饰</span></span><br><span class="line">        <span class="type">CouponDecorator</span> <span class="variable">couponDecorator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CouponDecorator</span>(milk, <span class="number">0.5</span>);</span><br><span class="line">        System.out.println(<span class="string">"商品（优惠卷）信息："</span>);</span><br><span class="line">        System.out.println(couponDecorator.desc());</span><br><span class="line">        System.out.println(couponDecorator.price());</span><br><span class="line">        System.out.println(<span class="string">"===================="</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line">商品基础信息：</span><br><span class="line">牛奶</span><br><span class="line"><span class="number">2.5</span></span><br><span class="line">====================</span><br><span class="line">商品（折扣）信息：</span><br><span class="line">牛奶, 折扣力度: <span class="number">0.75</span>折</span><br><span class="line"><span class="number">1.875</span></span><br><span class="line">====================</span><br><span class="line">商品（优惠卷）信息：</span><br><span class="line">牛奶, 直减: <span class="number">0.5</span>元</span><br><span class="line"><span class="number">2.0</span></span><br><span class="line">====================</span><br></pre></td></tr></tbody></table></figure>

<p>上面的代码中，我创建了一个商品接口并实现了这个接口，分别是 <code>Goods</code> 和 <code>Milk</code>，现在我们需要对牛奶进行装饰，例如折扣就是一个装饰，优惠卷也是一个装饰。所以我们需要先创建一个抽象类并实现 <code>Goods</code> 接口，这个抽象类就是装饰器类，它持有一个原对象的引用，随后我们就可以去继承这个抽象类，并在每个具体的装饰器类完成对原始对象的包装，这就是装饰器模式的作用。</p>
<p><strong>装饰器模式和代理模式有什么区别？</strong></p>
<p>装饰器和代理确实很相似，都是通过包装一个对象，扩展功能或控制行为，但他们还是有一些关键差异，具体如下：</p>
<p>目的不同：装饰器的重点在于扩展，增强了自身的功能。而代理侧重于控制访问，通常用于对原始对象做预处理、后处理和权限控制等</p>
<p>透明性：客户端是知道装饰器的存在，且可以通过不同的装饰器实现功能叠加。对于代理模式，客户端通常是不知道其存在的</p>
<p>适用场景：需要动态增加功能的场景（购物车各种商品的优惠）、文件的加密处理等</p>
<h3 id="组合（Composite）"><a href="#组合（Composite）" class="headerlink" title="组合（Composite）"></a>组合（Composite）</h3><p>组合模式通常将对象组合成树形结构，对于需要用树形结构表达的数据非常有用，例如公司组织架构、文件夹结构等，在组合模式中，我们将树的<code>叶子节点</code>和<code>组合节点（非叶子节点）</code>看作同一种数据类型，因此需要一个接口来将他们统一成一个数据类型。</p>
<p>组合模式包含三个角色，分别是<strong>基础组件</strong>、<strong>组合节点</strong>和<strong>叶子节点</strong>：</p>
<ol>
<li>基础组件：是一个接口，组合节点和叶子节点要实现这个接口，定义了共同行为</li>
<li>组合节点：实现基础组件接口，是一个<strong>容器</strong>类型的角色，包含叶子节点或其他组合节点，是组合模式的核心</li>
<li>叶子节点：实现基础组件接口，没有子节点，是组合模式内的最小单元</li>
</ol>
<p>下面以展示文件结构为例，具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件接口（基础组件）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileComponent</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件夹（组合节点）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Folder</span> <span class="keyword">implements</span> <span class="title class_">FileComponent</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileComponent&gt; components = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Folder</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addComponent</span><span class="params">(FileComponent component)</span> {</span><br><span class="line">        components.add(component);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeComponent</span><span class="params">(FileComponent component)</span> {</span><br><span class="line">        components.remove(component);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"【组合节点】文件名:"</span> + name);</span><br><span class="line">        <span class="comment">// 调用子节点的show方法</span></span><br><span class="line">        components.forEach(data -&gt; data.show());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件（叶子节点）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">File</span> <span class="keyword">implements</span> <span class="title class_">FileComponent</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">File</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"\t【叶子节点】文件名："</span> + name);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建文件</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"File1.txt"</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"File2.txt"</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"File3.txt"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建文件夹</span></span><br><span class="line">        <span class="type">Folder</span> <span class="variable">folder1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">"Folder1"</span>);</span><br><span class="line">        <span class="type">Folder</span> <span class="variable">folder2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">"Folder2"</span>);</span><br><span class="line">        <span class="type">Folder</span> <span class="variable">rootFolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">"Root"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 组合文件和文件夹</span></span><br><span class="line">        folder1.addComponent(file1);</span><br><span class="line">        folder1.addComponent(file2);</span><br><span class="line">        folder2.addComponent(file3);</span><br><span class="line">        rootFolder.addComponent(folder1);</span><br><span class="line">        rootFolder.addComponent(folder2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印结构</span></span><br><span class="line">        rootFolder.show();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line">【组合节点】文件名:Root</span><br><span class="line">【组合节点】文件名:Folder1</span><br><span class="line">	【叶子节点】文件名：File1.txt</span><br><span class="line">	【叶子节点】文件名：File2.txt</span><br><span class="line">【组合节点】文件名:Folder2</span><br><span class="line">	【叶子节点】文件名：File3.txt</span><br></pre></td></tr></tbody></table></figure>

<p>我们主要关注组合节点类和叶子节点类，<code>组合节点</code>类内部有个集合，通过这个集合来<code>保存</code>其子节点，同时提供 <code>add</code> 和 <code>remove</code> 方法来对集合内的子节点进行新增和删除操作。在组合节点的 <code>show</code> 方法中，除了打印当前节点名称外，还会递归调用每个子节点的 <code>show</code> 方法。对于<code>叶子节点</code>类来说，因为不包含其他子节点，所以 <code>show</code> 方法只需要打印出当前节点的名称即可。在客户端代码中，我们创建了 3 个文件（叶子节点），3 个文件夹（组合节点），并将其组合起来，最终放入到 Root 文件夹内，打印 root 文件夹的结构。</p>
<p>适用场景：文件系统、公司组织架构、菜单子系统等</p>
<h2 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a>行为型</h2><h3 id="责任链（Chain-of-Command）"><a href="#责任链（Chain-of-Command）" class="headerlink" title="责任链（Chain of Command）"></a>责任链（Chain of Command）</h3><p>责任链可以使多个对象都有机会处理请求，我们只需要将这些对象串成一条链，那么请求就会在这条链上传递，直到被成功处理为止。责任链的一大优点就是灵活，我们可以为每个请求分配属于自己的工作链，并且可以轻松扩展。例如我们现在有吃饭、睡觉、学习三个行动，对于婴儿来说，我们只需要为其分配吃饭和睡觉，而儿童我们则可以在吃饭后追加一个学习的行为。</p>
<p>责任链主要由<strong>抽象处理者</strong>、<strong>具体处理者</strong>、<strong>客户端</strong>三个角色组成：</p>
<ol>
<li><p>抽象处理者：负责定义处理请求的接口，并且持有对下一处理者的引用</p>
</li>
<li><p>具体处理者：抽象处理者的子类，负责实现抽象处理者的方法并完成对应逻辑</p>
</li>
<li><p>客户端：调用的一方，在这里我们需要完成责任链的创建并设置每个责任链的上级</p>
</li>
</ol>
<p>这里我们以公司内申请预算为例，如果金额在 100 及以下，那么交给小组审核，如果在 1000 及以下则交给经理，在 1000 以上则交给 CEO 处理，那么我们的责任链就可以串为小组 - 经理 - CEO。具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象处理者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Handler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Handler handler;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextHandler</span><span class="params">(Handler handler)</span> {</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">request</span><span class="params">(<span class="type">int</span> price)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 小组具体处理者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">request</span><span class="params">(<span class="type">int</span> price)</span> {</span><br><span class="line">        <span class="keyword">if</span> (price &gt;= <span class="number">10</span> &amp;&amp; price &lt;= <span class="number">100</span>) {</span><br><span class="line">            System.out.println(<span class="string">"组审核成功！"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"组审核失败，发送至下一级"</span>);</span><br><span class="line">        <span class="keyword">return</span> handler.request(price);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经理具体处理者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagerHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">request</span><span class="params">(<span class="type">int</span> price)</span> {</span><br><span class="line">        <span class="keyword">if</span> (price &gt; <span class="number">100</span> &amp;&amp; price &lt;= <span class="number">1000</span>) {</span><br><span class="line">            System.out.println(<span class="string">"管理审核成功"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"管理审核失败，发送至下一级"</span>);</span><br><span class="line">        <span class="keyword">return</span> handler.request(price);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// CEO具体处理者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CEOHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">request</span><span class="params">(<span class="type">int</span> price)</span> {</span><br><span class="line">        <span class="keyword">if</span> (price &gt; <span class="number">1000</span> &amp;&amp; price &lt; <span class="number">10000</span>) {</span><br><span class="line">            System.out.println(<span class="string">"CEO审核成功"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"金额过大，通过失败！"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建所有责任链</span></span><br><span class="line">        <span class="type">GroupHandler</span> <span class="variable">groupHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GroupHandler</span>();</span><br><span class="line">        <span class="type">ManagerHandler</span> <span class="variable">managerHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerHandler</span>();</span><br><span class="line">        <span class="type">CEOHandler</span> <span class="variable">CeoHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CEOHandler</span>();</span><br><span class="line">        <span class="comment">// 设置每个责任链的上级</span></span><br><span class="line">        groupHandler.setNextHandler(managerHandler);</span><br><span class="line">        managerHandler.setNextHandler(CeoHandler);</span><br><span class="line">        System.out.println(groupHandler.request(<span class="number">1001</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 组审核失败，发送至下一级</span><br><span class="line"> 管理审核失败，发送至下一级</span><br><span class="line"> CEO审核成功</span><br><span class="line"> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>适用场景：一个请求需要被多个对象按照顺序处理时、规则校验</p>
<h3 id="观察者（Observer）"><a href="#观察者（Observer）" class="headerlink" title="观察者（Observer）"></a>观察者（Observer）</h3><p>观察者模式可以在一个对象发生改变时，通知所有依赖于它的对象。就跟订阅机制一样，当有更新时，所有订阅了该频道的人都会收到消息通知，这些人可以去看新消息，也可以不看，这都取决于订阅者的操作。</p>
<p>观察者模式由被观察者接口、被观察者实现类、观察者接口和观察者实现类组成：</p>
<ol>
<li><p>被观察者接口：主题是被观察者的对象，提供添加、删除、<strong>通知观察者</strong>方法</p>
</li>
<li><p>被观察者实现类：被观察的对象，实现被观察者接口，可以通过<strong>通知观察者</strong>方法告诉所有观察者</p>
</li>
<li><p>观察者接口：通常只会有一个方法。所有观察者类必须实现该接口来接收通知</p>
</li>
<li><p>观察者实现类：实现了观察者接口的类，当观察的对象改变时，被观察者会调用观察者接口内的方法，并执行对应观察者类的逻辑</p>
</li>
</ol>
<p>下面的代码以 CEO 为被观察的对象，员工和经理为观察者，首先将员工和经理添加到了 CEO 的观察者集合内，CEO 调用接口发起通知，此时二者都会接收到消息。继续将员工踢出观察者集合，CEO 再次调用接口，只有经理收到消息。具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被观察者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addSubject</span><span class="params">(Subject subject)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeSubject</span><span class="params">(Subject subject)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">(String message)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被观察者实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CEOObServer</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Subject&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSubject</span><span class="params">(Subject subject)</span> {</span><br><span class="line">        observers.add(subject);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeSubject</span><span class="params">(Subject subject)</span> {</span><br><span class="line">        observers.remove(subject);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">(String message)</span> {</span><br><span class="line">        observers.forEach(data -&gt; data.update(message));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 员工观察者实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span> {</span><br><span class="line">        System.out.println(<span class="string">"EmployeeSubject : "</span> + message);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经理观察者实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagerSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span> {</span><br><span class="line">        System.out.println(<span class="string">"ManagerSubject : "</span> + message);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建一个CEO发布者和2个订阅者</span></span><br><span class="line">        <span class="type">CEOObServer</span> <span class="variable">ceoObServer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CEOObServer</span>();</span><br><span class="line">        <span class="type">EmployeeSubject</span> <span class="variable">employeeSubject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmployeeSubject</span>();</span><br><span class="line">        <span class="type">ManagerSubject</span> <span class="variable">managerSubject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerSubject</span>();</span><br><span class="line"></span><br><span class="line">        ceoObServer.addSubject(employeeSubject);</span><br><span class="line">        ceoObServer.addSubject(managerSubject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发布者发布消息</span></span><br><span class="line">        ceoObServer.notifyObservers(<span class="string">"消息通知"</span>);</span><br><span class="line">        System.out.println(<span class="string">"---删除employee订阅者---"</span>);</span><br><span class="line">        ceoObServer.removeSubject(employeeSubject);</span><br><span class="line">        ceoObServer.notifyObservers(<span class="string">"新消息通知"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> EmployeeSubject : 消息通知</span><br><span class="line"> ManagerSubject : 消息通知</span><br><span class="line"> ---删除employee订阅者---</span><br><span class="line"> ManagerSubject : 新消息通知</span><br></pre></td></tr></tbody></table></figure>

<p>适用场景：消息系统、多人协作实时编辑、对特定数据值进行监听等等</p>
<h3 id="策略模式（Strategy）"><a href="#策略模式（Strategy）" class="headerlink" title="策略模式（Strategy）"></a>策略模式（Strategy）</h3><p>策略模式可以将我们定义的一系列算法，封装到一个个独立的类中，在运行时选择不同的算法。策略模式的角色由策略接口、策略接口实现类和上下文类组成：</p>
<p>策略接口：是所有实现类的共同接口</p>
<p>接口实现类：负责实现具体的策略，封装算法详情</p>
<p>上下文类：提供策略对象的引用并通过接口调用返回具体策略的算法</p>
<p>这里以用户观看动画来做示例，现在我们有一个动画对象，其中名字、上线年份、集数字段有值，字幕组字段没值，因为有的人喜欢 A 字幕组、有的人喜欢 B 字幕组，所以我们要让用户自己选择看哪个字幕组，用户选 A 我们就加载 A 字幕，选 B 我们就加载 B 字幕，我们通过策略模式完成这个需求，具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动画类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Anime</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String onlineYear;</span><br><span class="line">    <span class="keyword">private</span> String episodes;</span><br><span class="line">    <span class="keyword">private</span> String subTitle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Anime</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Anime</span><span class="params">(String name, String onlineYear, String episodes, String subTitle)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.onlineYear = onlineYear;</span><br><span class="line">        <span class="built_in">this</span>.episodes = episodes;</span><br><span class="line">        <span class="built_in">this</span>.subTitle = subTitle;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOnlineYear</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> onlineYear;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnlineYear</span><span class="params">(String onlineYear)</span> {</span><br><span class="line">        <span class="built_in">this</span>.onlineYear = onlineYear;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEpisodes</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> episodes;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEpisodes</span><span class="params">(String episodes)</span> {</span><br><span class="line">        <span class="built_in">this</span>.episodes = episodes;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSubTitle</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> subTitle;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSubTitle</span><span class="params">(String subTitle)</span> {</span><br><span class="line">        <span class="built_in">this</span>.subTitle = subTitle;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Anime{"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", onlineYear='"</span> + onlineYear + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", episodes='"</span> + episodes + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", subTitle='"</span> + subTitle + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字幕的策略接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subtitle</span> {</span><br><span class="line">    Anime <span class="title function_">getAnime</span><span class="params">(Anime anime)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 北宇治字幕组实现策略接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KitaujiSub</span> <span class="keyword">implements</span> <span class="title class_">Subtitle</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Anime <span class="title function_">getAnime</span><span class="params">(Anime anime)</span> {</span><br><span class="line">        anime.setSubTitle(<span class="string">"北宇治字幕组"</span>);</span><br><span class="line">        <span class="keyword">return</span> anime;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 樱花字幕组实现策略接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SakuraSub</span> <span class="keyword">implements</span> <span class="title class_">Subtitle</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Anime <span class="title function_">getAnime</span><span class="params">(Anime anime)</span> {</span><br><span class="line">        anime.setSubTitle(<span class="string">"樱花字幕组"</span>);</span><br><span class="line">        <span class="keyword">return</span> anime;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择字幕的上下文类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubContext</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Subtitle subtitle;</span><br><span class="line">    <span class="keyword">private</span> Anime anime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SubContext</span><span class="params">(Subtitle subtitle,Anime anime)</span> {</span><br><span class="line">        <span class="built_in">this</span>.subtitle = subtitle;</span><br><span class="line">        <span class="built_in">this</span>.anime = anime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Anime <span class="title function_">getSubtitle</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> subtitle.getAnime(anime);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建2个动漫对象，字幕字段的值通过策略选择完成</span></span><br><span class="line">        <span class="type">Anime</span> <span class="variable">oshinoko</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Anime</span>();</span><br><span class="line">        oshinoko.setName(<span class="string">"推しのこ"</span>);</span><br><span class="line">        oshinoko.setOnlineYear(<span class="string">"2024"</span>);</span><br><span class="line">        oshinoko.setEpisodes(<span class="string">"12"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Anime</span> <span class="variable">makehiro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Anime</span>();</span><br><span class="line">        makehiro.setName(<span class="string">"負けヒロインは多すぎる"</span>);</span><br><span class="line">        makehiro.setOnlineYear(<span class="string">"2024"</span>);</span><br><span class="line">        makehiro.setEpisodes(<span class="string">"12"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过上下文对象获取加工完成的动画，参数为对应加工策略和动画对象</span></span><br><span class="line">        <span class="type">SubContext</span> <span class="variable">oshinokoSub</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubContext</span>(<span class="keyword">new</span> <span class="title class_">KitaujiSub</span>(), oshinoko);</span><br><span class="line">        <span class="type">SubContext</span> <span class="variable">makeiros</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubContext</span>(<span class="keyword">new</span> <span class="title class_">SakuraSub</span>(), makehiro);</span><br><span class="line"></span><br><span class="line">        System.out.println(oshinokoSub.getSubtitle());</span><br><span class="line">        System.out.println(makeiros.getSubtitle());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> Anime{name=<span class="string">'推しのこ'</span>, onlineYear=<span class="string">'2024'</span>, episodes=<span class="string">'12'</span>, subTitle=<span class="string">'北宇治字幕组'</span>}</span><br><span class="line"> Anime{name=<span class="string">'負けヒロインは多すぎる'</span>, onlineYear=<span class="string">'2024'</span>, episodes=<span class="string">'12'</span>, subTitle=<span class="string">'樱花字幕组'</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>上面的例子中，<code>算法</code>就是不同的字幕组策略，通过传入不同的<code>算法</code>来使动画对象获取到不同的加工结果。策略模式同样应用在线程池创建时选择的拒绝策略上，下为四个拒绝策略的源码，可以看出策略接口为 <code>RejectedExecutionHandler</code>，四个拒绝策略分别实现了各自的算法。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> {</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">CallerRunsPolicy</span><span class="params">()</span> { }</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> {</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) {</span><br><span class="line">                r.run();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AbortPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AbortPolicy</span><span class="params">()</span> { }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RejectedExecutionException</span>(<span class="string">"Task "</span> + r.toString() +</span><br><span class="line">                                             <span class="string">" rejected from "</span> +</span><br><span class="line">                                             e.toString());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DiscardPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DiscardPolicy</span><span class="params">()</span> { }</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> {</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DiscardOldestPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DiscardOldestPolicy</span><span class="params">()</span> { }</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> {</span><br><span class="line">        <span class="keyword">if</span> (!e.isShutdown()) {</span><br><span class="line">            e.getQueue().poll();</span><br><span class="line">            e.execute(r);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>都说策略模式消除 if-else，在选择策略的时候不还要用 if-else 判断选择哪个策略吗？</strong></p>
<p>策略模式消除的是 ** 行为执行中的 <code>if-else</code>**，也就是说在执行某个动作的时候不再显示地判断使用哪种实现。举个例子就是支付场景下，我们会有很多支付方式，微信、支付宝、银行卡、信用卡等等，不使用策略模式的话，我们需要 if 判断用户选择的方式，然后执行这个方式所对应的代码。使用策略模式的情况下，上面的这些支付方式会被封装为一个个策略类，我们只需要通过上下文类引入对应策略即可完成，代码中没有了选择支付方式的 if-else。消除的就是这部分的 if-else。同时策略模式的引入也让代码具有了更好的维护性和扩展性，以后新增支付方式，我们只需要新增一个策略类即可，不需要修改原代码。这个时候可能就有人问：<code>那么我们在选择策略的时候不还要使用if-else吗？</code>关于这个问题，我们可以通过一个 Map 解决。具体如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Subtitle&gt; SUB_MAP = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(){{</span><br><span class="line">        put(<span class="string">"sakura"</span>, <span class="keyword">new</span> <span class="title class_">SakuraSub</span>());</span><br><span class="line">        put(<span class="string">"kitauji"</span>, <span class="keyword">new</span> <span class="title class_">KitaujiSub</span>());</span><br><span class="line">    }};</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 创建2个动漫对象，字幕字段的值通过策略选择完成</span></span><br><span class="line">        <span class="type">Anime</span> <span class="variable">oshinoko</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Anime</span>();</span><br><span class="line">        oshinoko.setName(<span class="string">"推しのこ"</span>);</span><br><span class="line">        oshinoko.setOnlineYear(<span class="string">"2024"</span>);</span><br><span class="line">        oshinoko.setEpisodes(<span class="string">"12"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Anime</span> <span class="variable">makehiro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Anime</span>();</span><br><span class="line">        makehiro.setName(<span class="string">"負けヒロインは多すぎる"</span>);</span><br><span class="line">        makehiro.setOnlineYear(<span class="string">"2024"</span>);</span><br><span class="line">        makehiro.setEpisodes(<span class="string">"12"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过上下文对象获取加工完成的动画，参数为对应加工策略和动画对象</span></span><br><span class="line">        <span class="type">SubContext</span> <span class="variable">oshinokoSub</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubContext</span>(SUB_MAP.get(<span class="string">"kitauji"</span>), oshinoko);</span><br><span class="line">        <span class="type">SubContext</span> <span class="variable">makeiros</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubContext</span>(SUB_MAP.get(<span class="string">"sakura"</span>), makehiro);</span><br><span class="line">        System.out.println(oshinokoSub.getSubtitle());</span><br><span class="line">        System.out.println(makeiros.getSubtitle());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以将所有的策略放入一个 Map 内，然后通过用户选择的 key 直接获取对应的策略，即可消除选择策略时的 if-else。</p>
<p><strong>策略模式与工厂方法模式有什么区别？</strong></p>
<p>相信大部分人看完策略模式，会发现和工厂方法模式很像，确实这两者在结构上很像，但各自的目的又不一样。首先第一点从设计上来看，工厂方法模式属于创建型，关注的是对象的创建，而策略模式则是行为型，关注的是对算法的封装。第二点结构差异上，工厂方法包含 1 个接口，多个实现类和多个实现类的工厂，通过指定的工厂创建出指定的类。而策略模式包含 1 个策略接口、多个策略实现类和 1 个上下文类，通过一个上下文类选择一个策略。</p>
<p>适用场景：多场景支付、文件解压缩、某功能经常迭代且每次都要加入新逻辑等等</p>
<h3 id="模板方法（Template-Method）"><a href="#模板方法（Template-Method）" class="headerlink" title="模板方法（Template Method）"></a>模板方法（Template Method）</h3><p>模板方法通常用来定义<strong>算法的框架</strong>，将算法中的一些步骤延迟到子类，使子类可以在不改变算法结构的情况下重新定义算法中的某些步骤。模板方法的结构非常简单，只有父类和子类：</p>
<ol>
<li><p>抽象类：模板方法的核心，定义了算法的框架，包含一个模板方法、一个或多个抽象方法、可选的初始化方法以及钩子方法（钩子方法可以在子类中选择是否重写，通常用来修改模板方法内的一些逻辑）</p>
</li>
<li><p>具体类：继承抽象类并实现抽象方法，完成该算法的具体实现。</p>
</li>
</ol>
<p>我们以游戏创建角色时选择角色属性为例，具体代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模板方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseBoard</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">createPerson</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 初始化玩家职业</span></span><br><span class="line">        initProfession();</span><br><span class="line">        <span class="comment">// 初始化玩家基础属性</span></span><br><span class="line">        initAttr();</span><br><span class="line">        <span class="comment">// 初始化玩家出生地</span></span><br><span class="line">        initAddress();</span><br><span class="line">        <span class="comment">// 初始化玩家等级</span></span><br><span class="line">        initLevel();</span><br><span class="line">        <span class="comment">// 玩家是否选择了初始道具</span></span><br><span class="line">        <span class="keyword">if</span> (chooseItem()) {</span><br><span class="line">            initItem();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">initProfession</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">initAttr</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">initAddress</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">chooseItem</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initLevel</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"等级：1"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initItem</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"初始道具：火焰壶"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类 魔法师</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mage</span> <span class="keyword">extends</span> <span class="title class_">BaseBoard</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initProfession</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"职业：魔法师"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initAttr</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"属性："</span>);</span><br><span class="line">        System.out.println(<span class="string">"    生命： 3"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    力量： 0"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    魔力： 12"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    耐力： 5"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initAddress</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"出生地：雷古拉魔法学院"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类 战士</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Warrior</span> <span class="keyword">extends</span> <span class="title class_">BaseBoard</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initProfession</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"职业：战士"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initAttr</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"属性："</span>);</span><br><span class="line">        System.out.println(<span class="string">"    生命： 7"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    力量： 10"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    魔力： 1"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    耐力： 5"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initAddress</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"出生地：王城征兵所"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">chooseItem</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类 小偷</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thief</span> <span class="keyword">extends</span> <span class="title class_">BaseBoard</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initProfession</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"职业：小偷"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initAttr</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"属性："</span>);</span><br><span class="line">        System.out.println(<span class="string">"    生命： 5"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    力量： 3"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    魔力： 5"</span>);</span><br><span class="line">        System.out.println(<span class="string">"    耐力： 7"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initAddress</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"出生地：初始之地"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Thief</span> <span class="variable">elf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thief</span>();</span><br><span class="line">        elf.createPerson();</span><br><span class="line">        System.out.println(<span class="string">"===================================="</span>);</span><br><span class="line">        <span class="type">Warrior</span> <span class="variable">warrior</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Warrior</span>();</span><br><span class="line">        warrior.createPerson();</span><br><span class="line">        System.out.println(<span class="string">"===================================="</span>);</span><br><span class="line">        <span class="type">Mage</span> <span class="variable">mage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mage</span>();</span><br><span class="line">        mage.createPerson();</span><br><span class="line">        System.out.println(<span class="string">"===================================="</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出</span></span><br><span class="line"> 职业：小偷</span><br><span class="line"> 属性：</span><br><span class="line">     生命： <span class="number">5</span></span><br><span class="line">     力量： <span class="number">3</span></span><br><span class="line">     魔力： <span class="number">5</span></span><br><span class="line">     耐力： <span class="number">7</span></span><br><span class="line"> 出生地：初始之地</span><br><span class="line"> 等级：<span class="number">1</span></span><br><span class="line"> ====================================</span><br><span class="line"> 职业：战士</span><br><span class="line"> 属性：</span><br><span class="line">     生命： <span class="number">7</span></span><br><span class="line">     力量： <span class="number">10</span></span><br><span class="line">     魔力： <span class="number">1</span></span><br><span class="line">     耐力： <span class="number">5</span></span><br><span class="line"> 出生地：王城征兵所</span><br><span class="line"> 等级：<span class="number">1</span></span><br><span class="line"> 初始道具：火焰壶</span><br><span class="line"> ====================================</span><br><span class="line"> 职业：魔法师</span><br><span class="line"> 属性：</span><br><span class="line">     生命： <span class="number">3</span></span><br><span class="line">     力量： <span class="number">0</span></span><br><span class="line">     魔力： <span class="number">12</span></span><br><span class="line">     耐力： <span class="number">5</span></span><br><span class="line"> 出生地：雷古拉魔法学院</span><br><span class="line"> 等级：<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面的代码中，<code>BaseBoard</code> 类定义了模板方法 <code>createPerson()</code>，将所有的步骤封装在内。三个子类重写所有抽象方法，实现了具体的属性初始化逻辑。其中 <code>Warrior</code> 类又单独重写了 <code>chooseItem()</code> 方法，使其返回 true，从而允许角色选择初始道具。<code>BaseBoard</code> 中的共通方法 <code>initLevel()</code> 确保所有角色的等级都为 1。</p>
<p>适用场景：多个子类共享相同的操作逻辑、多格式报表生成、多格式数据处理等等</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://33sora.com/">Sora33</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://33sora.com/posts/ef6e6a13.html">http://33sora.com/posts/ef6e6a13.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://33sora.com" target="_blank">Sora33</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post-share"><div class="social-share" data-image="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/41ed1960.html" title="基于 ollama 从零部署大语言模型"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">基于 ollama 从零部署大语言模型</div></div><div class="info-2"><div class="info-item-1">前言环境介绍：使用的 Python 版本为 3.12.4 且需要科学上网，对电脑性能有一定需求（但也没那么离谱） 相信不少人已经体验过 Ai 带来的便利了，甚至在工作上使用 Ai 加以辅助。本文是对那些对 Ai 产生兴趣且希望在自己的设备上实际运行大语言模型的人而准备，希望可以通过这篇文章来让更多人认识和了解 Ai。本文是基于 ollama 创建和部署大语言模型，下面就开始进入正文。 ollama 是什么？ollama 是一个管理大语言模型的工具，帮助我们在本地快速创建、部署、使用大语言模型。它本身并不是一个大语言模型！还有一个名词 llama，它跟 ollama 很像，但是区别可就大了。llama 是由 Meta 开发的大语言模型，所以我们可以使用 ollama 加载 llama 这样的大语言模型。 安装 ollama进入 ollama 官网，点击下载按钮，安装到自己电脑上即可。安装完成后可以使用 ollama -v 测试是否安装成功  使用 ollama 运行 llama3.2 模型我们先简单启动一个模型进行测试，我们以 Meta 最新的 llama3.2 的 1b...</div></div></div></a><a class="pagination-related" href="/posts/144a2659.html" title="Java21 虚拟线程的研究与使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-x8kzjo_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Java21 虚拟线程的研究与使用</div></div><div class="info-2"><div class="info-item-1">认识虚拟线程 在 Java21 中正式引入了虚拟线程，它与我们目前所使用的传统线程（也叫平台线程）有什么区别，本文针对虚拟线程来进行研究并实战一些案例，帮助大家理解。 虚拟线程是在 Java19 中初次出现并在 Java21 中正式推出。与平台线程相比，它具有以下优势： 轻量化：虚拟线程是一个轻量化的线程，由 JVM 管理，所以创建和销毁的开销都很小，可以轻松创建上百万个线程。平台线程则是由系统内核直接管理，一个平台线程对应一个系统内核，自然创建和销毁的开销成本会比较高 无阻塞影响：在平台线程中，如果遇到阻塞时会阻塞操作系统对应的线程，导致降低系统的并发的能力。在虚拟线程中，如果遇到阻塞时并不会真正阻塞操作系统的线程，而是会自动挂起并释放资源，保证系统线程的可用性 资源管理：因为虚拟线程轻量化的原因，所以永远不应该池化，每个任务都会创建一个新的虚拟线程，使用完成后销毁。而平台线程则因为重量级，所以必须进行池化来进行资源复用 调度效率：因为虚拟线程是 JVM...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/59324e24.html" title="手写单例模式以及保证安全性"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-yx8lqk_1920x1080.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-25</div><div class="info-item-2">手写单例模式以及保证安全性</div></div><div class="info-2"><div class="info-item-1">单例模式的几个特点 为了确保全局只有一个类的实例，所以类的构造器要私有化 单例类必须由自己创建自己的唯一实例 单例类必须给其他对象提供这一个实例  单例模式是一个最简单的设计模式，属于创建型结构。比如我们 window 中的任务管理器，回收站，操作系统就是一个单例的设计。也就是说我们使用的对象永远是同一个。程序中的单例大致可以分为 4 大类。饿汉式、懒汉式、双重锁和静态内部类。我们先来说饿汉式 饿汉式饿汉式是一个简单的写法，和名字一样。他很饿，饿的话救急着要东西。所以他会在类加载的时候就初始化。是一个线程安全的操作。但因为不是懒加载，所以不管我们用没用这个实例。他都会实例化。可能会造成一些不必要的内存。浪费内存资源。 1234567891011121314151617/** * @className: Singleton * @description: 饿汉式 * @date: 2022/08/25 * @author: Sora33 */public class Singleton {    // 饿汉    private static Singleton...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/nayuta.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Sora33</div><div class="author-info-description">未来无限可能</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">63</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2097665736&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/img/sora33QR.jpg" target="_blank" title="VX"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Java/自宅警备员/nayuta单推人<br>本站主要记录自己自学的一些技术,欢迎各位一起留言讨论。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">设计模式是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">设计模式的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.</span> <span class="toc-text">设计模式的六大原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">设计模式的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">创建型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Singleton%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">单例模式（Singleton）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%EF%BC%88Factory-Method%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">工厂方法（Factory Method）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%EF%BC%88Builder%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">建造者（Builder）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%EF%BC%88Abstract-Factory%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">抽象工厂（Abstract Factory）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Prototype%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">原型模式（Prototype）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">结构型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%EF%BC%88Adapter%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">适配器（Adapter）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%EF%BC%88Facade%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">外观（Facade）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%EF%BC%88Proxy%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">代理（Proxy）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%EF%BC%88Decorator%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">装饰器（Decorator）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%EF%BC%88Composite%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">组合（Composite）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">行为型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%EF%BC%88Chain-of-Command%EF%BC%89"><span class="toc-number">4.1.</span> <span class="toc-text">责任链（Chain of Command）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%EF%BC%88Observer%EF%BC%89"><span class="toc-number">4.2.</span> <span class="toc-text">观察者（Observer）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%EF%BC%88Strategy%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">策略模式（Strategy）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%EF%BC%88Template-Method%EF%BC%89"><span class="toc-number">4.4.</span> <span class="toc-text">模板方法（Template Method）</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/dcc14389.html" title="写了一个 Java 中过滤实体类字段的小项目"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-m9ozwm_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="写了一个 Java 中过滤实体类字段的小项目"/></a><div class="content"><a class="title" href="/posts/dcc14389.html" title="写了一个 Java 中过滤实体类字段的小项目">写了一个 Java 中过滤实体类字段的小项目</a><time datetime="2024-12-24T08:12:50.000Z" title="发表于 2024-12-24 16:12:50">2024-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/16a3faad.html" title="如何将自己的 jar 包发布到 Maven 中央仓库？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/241219/wallhaven-v9852l_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何将自己的 jar 包发布到 Maven 中央仓库？"/></a><div class="content"><a class="title" href="/posts/16a3faad.html" title="如何将自己的 jar 包发布到 Maven 中央仓库？">如何将自己的 jar 包发布到 Maven 中央仓库？</a><time datetime="2024-12-19T02:42:15.000Z" title="发表于 2024-12-19 10:42:15">2024-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/89e44969.html" title="hexo &amp; butterfly 升级与注意要点"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo &amp; butterfly 升级与注意要点"/></a><div class="content"><a class="title" href="/posts/89e44969.html" title="hexo &amp; butterfly 升级与注意要点">hexo &amp; butterfly 升级与注意要点</a><time datetime="2024-12-09T07:10:21.000Z" title="发表于 2024-12-09 15:10:21">2024-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/41ed1960.html" title="基于 ollama 从零部署大语言模型"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/wallhaven-rdwmgj_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 ollama 从零部署大语言模型"/></a><div class="content"><a class="title" href="/posts/41ed1960.html" title="基于 ollama 从零部署大语言模型">基于 ollama 从零部署大语言模型</a><time datetime="2024-09-27T05:33:47.000Z" title="发表于 2024-09-27 13:33:47">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ef6e6a13.html" title="个人对设计模式的理解与实践 (持续缓更)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="个人对设计模式的理解与实践 (持续缓更)"/></a><div class="content"><a class="title" href="/posts/ef6e6a13.html" title="个人对设计模式的理解与实践 (持续缓更)">个人对设计模式的理解与实践 (持续缓更)</a><time datetime="2024-09-10T05:24:04.000Z" title="发表于 2024-09-10 13:24:04">2024-09-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/0131/wallhaven-weee76_1920x1080.png);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Sora33</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn"><span>晋ICP备2022007182号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://sprightly-liger-8d5ebf.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://sprightly-liger-8d5ebf.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>