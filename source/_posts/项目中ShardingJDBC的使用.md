---
title: åœ¨é¡¹ç›®ä¸­å¼•å…¥ShardingJDBCå¹¶æ•´åˆMybatisPlus
tags:
  - ShardingJDBC
  - åˆ†åº“åˆ†è¡¨
categories: æ•™ç¨‹
abbrlink: cff84f64
date: 2023-04-22 08:41:55
---

## ShardingJDBCä»‹ç»

SharingdJDBCæ˜¯ShardSphereä¸­çš„ä¸€ç§å®ç°æ–¹å¼ï¼ˆShardingSphere-Proxyæ˜¯ä»£ç†ï¼Œç›¸å½“äºä¸€ä¸ªä¸­é—´ä»¶ï¼ŒæŠŠæ‰€æœ‰çš„è¯·æ±‚ç»Ÿä¸€å‘åˆ°Proxyä¸Šï¼Œåœ¨Proxyä¸Šå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼›æœ€åä¸€ä¸ªæ˜¯Sidecarï¼Œç›¸å½“äºæä¾›ä¸€ä¸ªå¤§ç½‘ï¼Œå°†æ‰€æœ‰çš„æ•°æ®åº“ç»‡èµ·æ¥ï¼Œä¸€èˆ¬ç”¨äºå¾®æœåŠ¡ä¸­ï¼‰å®ƒä¸€ä¸ªè½»é‡çº§çš„Javaæ¡†æ¶ï¼Œé›†æˆåœ¨ç¨‹åºé‡Œï¼Œé€šè¿‡jaråŒ…çš„æ–¹å¼æä¾›æœåŠ¡ï¼Œå¹¶ä¸”æ”¯æŒå¾ˆå¤šORMæ¡†æ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„Mybatisã€JPAã€Hibernateç­‰ç­‰

### ShardingJDBCçš„ä¸€äº›æ¦‚å¿µ

é€»è¾‘è¡¨ï¼šæˆ‘ä»¬ä¸€èˆ¬æŠŠç»“æ„å’Œé€»è¾‘ä¸€è‡´çš„è¡¨ç§°ä¸ºé€»è¾‘è¡¨ï¼Œä¾‹å¦‚userè¡¨æˆ‘æ‹†åˆ†ä¸ºäº†user01å’Œuser02ï¼Œé™¤äº†åå­—ä»¥å¤–ï¼Œå…¶ä»–éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆuserå°±æ˜¯ä¸€å¼ é€»è¾‘è¡¨ã€‚

çœŸå®è¡¨ï¼šçœŸå®è¡¨å°±æ˜¯çœŸå®å­˜åœ¨çš„è¡¨ï¼Œä¸Šé¢çš„user01å’Œuser02å°±æ˜¯çœŸå®è¡¨

å¹¿æ’­è¡¨ï¼šå…¬ç”¨çš„ä¸€äº›è¡¨ï¼Œç›¸å½“äºæŠ½è±¡ç‰ˆçš„"å·¥å…·ç±»"

åˆ†ç‰‡é”®ï¼šæˆ‘ä»¬åˆ†è¡¨æ˜¯æŒ‰ç…§å“ªä¸ªå­—æ®µå»åˆ†ï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯åˆ†ç‰‡é”®

åˆ†ç‰‡ç®—æ³•ï¼šç¡®å®šåˆ†ç‰‡é”®åè¦å¦‚ä½•å»è®¡ç®—åˆ°å…·ä½“çš„è¡¨ã€‚å¸¸ç”¨çš„æœ‰`å–æ¨¡è¿ç®—ã€`hashç®—æ³•`ä»¥åŠ`èŒƒå›´ç®—æ³•`

åˆ†ç‰‡ç­–ç•¥ï¼šç”±`åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ç®—æ³•`ç»„æˆã€‚ç”¨äºç¡®å®šæ•°æ®åº”è¯¥å­˜å‚¨åœ¨å“ªä¸ªåˆ†ç‰‡ä¸­çš„ç®—æ³•æˆ–è§„åˆ™ã€‚ä¾‹å¦‚è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç­–ç•¥ã€æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ã€èŒƒå›´åˆ†ç‰‡ç­–ç•¥...

åˆ†ç‰‡è§„åˆ™ç®¡ç†å™¨ï¼šè´Ÿè´£ç®¡ç†åˆ†ç‰‡è§„åˆ™å’Œåˆ†ç‰‡ç­–ç•¥ï¼Œæ ¹æ®åˆ†ç‰‡è§„åˆ™å°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„æ•°æ®åº“èŠ‚ç‚¹ä¸­ã€‚

æ•°æ®åº“è·¯ç”±å™¨ï¼šæ ¹æ®SQLè¯­å¥ä¸­çš„åˆ†ç‰‡é”®ï¼Œé€šè¿‡åˆ†ç‰‡è§„åˆ™ç®¡ç†å™¨å°†æ•°æ®è·¯ç”±åˆ°ç›¸åº”çš„æ•°æ®åº“èŠ‚ç‚¹ä¸­ã€‚

æ•°æ®åº“ä»£ç†ï¼šè´Ÿè´£å°†SQLè¯­å¥å‘é€åˆ°ç›¸åº”çš„æ•°æ®åº“èŠ‚ç‚¹ï¼Œå¹¶å°†ç»“æœåˆå¹¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚

## é¡¹ç›®å®æˆ˜

### å¼•å…¥ä¾èµ–

æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥ä¸€ä¸ªShardingçš„ä¾èµ–ï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯5.2.1ç‰ˆæœ¬ã€‚æœ¬æ¬¡æˆ‘ä¹Ÿæ•´åˆäº†MybatisPlusï¼Œæ‰€ä»¥éœ€è¦å¤šå¼•å…¥ä¸€ä¸ªMybatisPlusçš„ä¾èµ–ä»¥åŠdruidè¿æ¥æ± 

```xml
<!--ShardingJDBC-->
<dependency>
  <groupId>org.apache.shardingsphere</groupId>
  <artifactId>shardingsphere-jdbc-core-spring-boot-starter</artifactId>
  <version>5.2.1</version>
</dependency>

<!--druid-->
<dependency>
  <groupId>com.alibaba</groupId>
  <artifactId>druid</artifactId>
  <version>1.2.16</version>
</dependency>

<!--mybatis-plus-->
<dependency>
  <groupId>com.baomidou</groupId>
  <artifactId>mybatis-plus-boot-starter</artifactId>
  <version>3.5.3.1</version>
</dependency>

```

### é…ç½®æ–‡ä»¶

ShardingJDBCæœ€æ ¸å¿ƒçš„å°±æ˜¯é…ç½®éƒ¨åˆ†ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨å•åº“åŒè¡¨å®ç°æ°´å¹³åˆ†è¡¨å…ˆåšä¸ªå°demoï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿäº†è§£è®¤è¯†Shardingã€‚

æˆ‘åœ¨æ•°æ®åº“ä¸­æœ‰2å¼ è¡¨ï¼Œåˆ†åˆ«ä¸ºsora_user01å’Œsora_user02ã€‚æ‰“ç®—æ¯æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™æ ¹æ®idå–æ¨¡åˆ¤æ–­åº”è¯¥è½åˆ°01è¿˜æ˜¯02ã€‚ç„¶åç”¨æˆ·è¯»å–çš„æ—¶å€™ä»2å¼ è¡¨ä¸­ä¸€èµ·è·å–æ•°æ®ã€‚

æ°´å¹³åˆ†è¡¨å¯ä»¥é™ä½å•è¡¨çš„æ•°æ®é‡ã€‚demoåé¢ä¼šç”¨2ä¸ªæ•°æ®æºå’Œ2å¼ è¡¨æ¥è¿˜åŸé¡¹ç›®çš„çœŸå®æƒ…å†µ

![image-20230501123157892](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011231943.png)

```yaml
server:
  port: 1234
spring:
  data:
    redis:
      port: 6379
      password: 1202
      host: 127.0.0.1
      database: 0
  #shardingjdbcä¸»è¦é…ç½®
  shardingsphere:
    datasource:
      # æ•°æ®æº
      names: ds0
      # æ•°æ®æºåå­—
      ds0:
        type: com.alibaba.druid.pool.DruidDataSource
        driverClassName: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://127.0.0.1:3306/sora33?serverTimezone=UTC
        username: root
        password: root
    # è§„åˆ™é…ç½®
    rules:
      sharding:
        # é…ç½®å„ç§è¡¨
        tables:
          # è¡¨åï¼Œå¯¹åº”Javaä¸­å®ä½“ç±»çš„ç±»å
          user:
            # çœŸå®è¡¨ {1..2}è¡¨ç¤ºèŒƒå›´1-2 {1,2}è¡¨ç¤ºæšä¸¾ 1å’Œ2
            actualDataNodes: ds0.sora_user0$->{1..2}
            # åˆ†ç‰‡ç­–ç•¥é…ç½®
            tableStrategy:
              # æ ‡å‡†åˆ†ç‰‡
              standard:
                # åˆ†ç‰‡åˆ—ï¼ˆæ•°æ®åº“ä¸­çš„å­—æ®µåï¼‰
                shardingColumn: id
                # è¡¨çš„åˆ†ç‰‡ç®—æ³•åç§° å¼•å…¥æˆ‘ä»¬åˆšåˆšé…ç½®çš„user-inline
                shardingAlgorithmName: user-inline
        # åˆ†ç‰‡ç®—æ³•çš„é…ç½®
        sharding-algorithms:
          # åˆ†ç‰‡ç®—æ³•åç§°
          user-inline:
            # ä½¿ç”¨INLINEè¡¨è¾¾å¼
            type: INLINE
            props:
              # åˆ†ç‰‡ç®—æ³•çš„è¡Œè¡¨è¾¾å¼
              algorithm-expression: sora_user0$->{id % 2 + 1}
        # é…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥ ä½¿ç”¨é›ªèŠ±ç®—æ³•
        keyGenerators:
          snowflake:
            type: SNOWFLAKE
        props:
          #ã€€æ˜¯å¦æ˜¾ç¤ºsql
          sql-show: true
mybatis-plus:
  mapper-locations: classpath:mapper/**/*.xml
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    map-underscore-to-camel-case: true
```

Shardingçš„é…ç½®æˆ‘æŠŠå®ƒåˆ†ä¸ºä¸‰å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯`é€»è¾‘è¡¨çš„é…ç½®`åˆ†è¡¨/åˆ†åº“ç­–ç•¥`idç”Ÿæˆç­–ç•¥`

è¿™ä¸‰ä¸ªéƒ½è¦é…ç½®åœ¨ rulesä¸‹çš„ shardingä¸­

é¦–å…ˆæ¥è¯´è¯´åˆ†è¡¨/åˆ†åº“çš„ç­–ç•¥é…ç½®ï¼Œè¿™éƒ¨åˆ†å¯¹åº”çš„æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„sharding-algorithmsï¼Œæˆ‘ä»¬éœ€è¦å…ˆé…ç½®ç®—æ³•åç§°ï¼Œè¿™ä¸ªæ˜¯è‡ªå®šä¹‰çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬ç»™userè¡¨é…ç½®åˆ†ç‰‡ç®—æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥å«user-inlineã€‚éšååœ¨ç®—æ³•ä¸­é…ç½®2ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯typeç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨INLINEè¡¨è¾¾å¼ã€‚ç„¶åæ˜¯propsä¸­çš„algorithm-expressioné…ç½®åˆ†ç‰‡ç®—æ³•çš„å…·ä½“é€»è¾‘ã€‚æˆ‘è¿™é‡ŒæŒ‰ç…§id%2+1ï¼Œå¹³æ‘Šåœ¨01å’Œ02ä¸¤ä¸ªè¡¨ä¸­ã€‚

å†æ¥è¯´é€»è¾‘è¡¨çš„é…ç½®ï¼Œå¯¹åº”é…ç½®æ–‡ä»¶ä¸­tablesï¼Œæˆ‘ä»¬é¦–å…ˆé…ç½®è¡¨åï¼Œè¿™ä¸ªæ˜¯è‡ªå®šä¹‰çš„åå­—ï¼Œæˆ‘ä¹ æƒ¯è·ŸJavaçš„å®ä½“ç±»å¯¹åº”ï¼ˆæˆ‘ä¹Ÿè¯•è¿‡ä½¿ç”¨è¿‡æ•°æ®åº“çš„è¡¨åå­—å‘ç°æœ‰é—®é¢˜ï¼‰ã€‚æ¥ç€éœ€è¦é…ç½®çœŸå®è¡¨ï¼Œä¹Ÿå°±æ˜¯actualDataNodesçš„å†…å®¹ï¼Œç”±æ•°æ®æº+è¡¨åç»„æˆï¼Œé…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šã€‚ä¸‹é¢æ˜¯åˆ†ç‰‡ç­–ç•¥tableStrategyï¼Œè¿™ä¸ªæ˜¯å›ºå®šçš„ã€‚æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªåˆ†ç‰‡ç­–ç•¥ã€‚ShardingJDBCä¸€å…±æœ‰4ç§åˆ†ç‰‡ç­–ç•¥ã€‚

`standard-é€‚ç”¨äºå•åˆ†ç‰‡é”®åœºæ™¯` 

`complex-é€‚ç”¨äºå¤šåˆ†ç‰‡é”®åœºæ™¯`

 `hint-é€šè¿‡HintæŒ‡å®šåˆ†ç‰‡å€¼è¿›è¡Œåˆ†ç‰‡`

 `none-ä¸åˆ†ç‰‡`

æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å•åˆ†ç‰‡é”®æ¥è¿›è¡Œåˆ†ç‰‡ï¼Œæ‰€ä»¥é€‰æ‹©standardã€‚é…ç½®2ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸ºåˆ†ç‰‡åˆ—ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§å“ªä¸ªå­—æ®µè¿›è¡Œåˆ†ç‰‡ã€‚ç¬¬äºŒä¸ªå±æ€§ä¸ºåˆ†ç‰‡ç®—æ³•ï¼Œæˆ‘ä»¬å¼•å…¥åˆšåˆšè‡ªå®šä¹‰çš„user-inlineç®—æ³•å°±å¯ä»¥ã€‚

æœ€åæ˜¯ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼Œä¸€èˆ¬åˆ†å¸ƒå¼é¡¹ç›®æˆ‘ä»¬ä½¿ç”¨é›ªèŠ±idå°±å¯ä»¥äº†ï¼Œå›ºå®šä½¿ç”¨SNOWFLAKEæ¥å®Œæˆã€‚

å¦‚æœæ²¡æœ‰çœ‹æ˜ç™½æˆ–è€…æƒ³äº†è§£æ›´å¤šçš„å¯ä»¥å»çœ‹çœ‹å®˜ç½‘çš„è¯´æ˜

> https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/

### åç«¯ä»£ç 

ç»å…¸çš„MybatisPlusï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†

æ–°å¢ç”¨æˆ·çš„ä»£ç ï¼š

```	java
 /**
     * éšæœºç”Ÿæˆä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶æ’å…¥
     * @return
     */
    @Override
    public Result insertUser() {
        int age = generateRandomNumber(10, 60);
        long snowServiceId = snowService.getId();
        User user = new User("testName", age, "ç”·",snowServiceId);
        userMapper.insert(user);
        return Result.success();
    }
    
    public static int generateRandomNumber(int min, int max) {
        Random random = new Random();
        int randomNumber = random.nextInt((max - min) + 1) + min;
        return randomNumber;
    }
```

æŸ¥è¯¢ä»£ç ï¼š

```java
/**
     * æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·
     * @param id
     * @return
     */
    @Override
    public Result selectUserById(Long id) {
        LambdaQueryWrapper<User> query = Wrappers.lambdaQuery();
        query.eq(User::getId, id);
        return Result.success(userMapper.selectList(query));
    }
```

### æµ‹è¯•ç»“æœ

ä»¥ä¸Šçš„å·¥ä½œå®Œæˆåï¼Œå°±å¯ä»¥è¯•éªŒäº†ï¼Œå…ˆä½¿ç”¨postmanæ·»åŠ äº†11æ¡æ•°æ®

![image-20230501125633929](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011256975.png)

![image-20230501125644379](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011256410.png)

å¯ä»¥å‘ç°idå°¾æ•°ä¸ºå¥‡æ•°çš„åœ¨02è¡¨ä¸­ï¼Œidä¸ºå¶æ•°çš„åœ¨01è¡¨å†…ã€‚æˆåŠŸæŒ‰ç…§åˆ†ç‰‡ç­–ç•¥æ·»åŠ æˆåŠŸã€‚æ¥ç€æˆ‘ä»¬è¯•ä¸€ä¸‹æŸ¥è¯¢

![image-20230501125831147](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011258183.png)

å‘ç°æŠ¥é”™äº†ï¼Œè¯´çš„æ˜¯å’Œåˆ†ç‰‡ç®—æ³•ä¸åŒ¹é…ã€‚

æˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°idæ˜¯Stringç±»å‹çš„ï¼ŒStringç±»å‹æ˜¯ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨%è¿ç®—çš„ã€‚

![image-20230501130108969](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011301028.png)

çœ‹ä¸€ä¸‹controllerï¼Œå°†Stringæ”¹ä¸ºLongå³å¯

![image-20230501130157747](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011301787.png)

å†è¯•ä¸€æ¬¡ï¼ŒæŸ¥è¯¢æˆåŠŸ

![image-20230501130247683](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011302725.png)

å½“ç„¶æ’æŸ¥è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ’æŸ¥äº†å°†è¿‘åŠå¤©ï¼Œå„ç§è®ºå›å’Œgithubä¹Ÿæé—®äº†ï¼ŒæœŸé—´ä¹Ÿé—®äº†å¾ˆå¤šæ¬¡ChatGPTä¹Ÿæ²¡ç»“æœï¼Œæœ€ååæ­£å°±æ˜¯çœ‹åˆ°GPTåœ¨INLINEè¡¨è¾¾å¼ä¸­ç”¨äº†Mathå‡½æ•°æ‰çªç„¶æœ‰äº†çµæ„ŸğŸ¤”

### åŒæ•°æ®æºåŒè¡¨å®æˆ˜

æˆ‘ä»¬æ¥ä¸‹æ¥å°è¯•åœ¨2ä¸ªæ•°æ®æºä¸­åˆ†åº“åˆ†è¡¨çš„ç­–ç•¥ã€‚è¿˜æ˜¯ä¸€æ ·æˆ‘ä»¬åŠ ä¸€ä¸ªåˆ†åº“çš„ç­–ç•¥ï¼Œå«database-inlineï¼Œç„¶ååœ¨tablesè¡¨ä¸­å¼•å…¥databaseçš„åˆ†ç‰‡ç­–ç•¥ã€‚

```yaml
  #shardingjdbcä¸»è¦é…ç½®
  shardingsphere:
    datasource:
      # æ•°æ®æº
      names: ds0,ds1
      # æ•°æ®æºåå­—
      ds0:
        type: com.alibaba.druid.pool.DruidDataSource
        driverClassName: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://127.0.0.1:3306/sora33?serverTimezone=UTC
        username: root
        password: root
      ds1:
        type: com.alibaba.druid.pool.DruidDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://150.158.xx.xx:3306/sora33?serverTimezone=UTC
        username: root
        password: root
    # è§„åˆ™é…ç½®
    rules:
      sharding:
        # é…ç½®å„ç§è¡¨
        tables:
          # è¡¨åï¼Œå¯¹åº”Javaä¸­å®ä½“ç±»çš„ç±»å
          user:
            # çœŸå®è¡¨ {1..2}è¡¨ç¤ºèŒƒå›´1-2 {1,2}è¡¨ç¤ºæšä¸¾ 1å’Œ2
            actualDataNodes: ds$->{0..1}.sora_user0$->{1..2}
            # åˆ†ç‰‡ç­–ç•¥é…ç½®
            tableStrategy:
              # æ ‡å‡†åˆ†ç‰‡
              standard:
                # åˆ†ç‰‡åˆ—ï¼ˆæ•°æ®åº“ä¸­çš„å­—æ®µåï¼‰
                shardingColumn: id
                # è¡¨çš„åˆ†ç‰‡ç®—æ³•åç§° å¼•å…¥æˆ‘ä»¬åˆšåˆšé…ç½®çš„user-inline
                shardingAlgorithmName: user-inline
            database-strategy:
              standard:
                sharding-column: id
                shardingAlgorithmName: database-inline
        # åˆ†ç‰‡ç®—æ³•çš„é…ç½®
        sharding-algorithms:
          # åˆ†ç‰‡ç®—æ³•åç§°
          user-inline:
            # ä½¿ç”¨INLINEè¡¨è¾¾å¼
            type: INLINE
            props:
              # åˆ†ç‰‡ç®—æ³•çš„è¡Œè¡¨è¾¾å¼
              algorithm-expression: sora_user0$->{id % 2 + 1}
          # åˆ†åº“ç®—æ³•
          database-inline:
            type: INLINE
            props:
              algorithm-expression: ds$->{id % 2}
        # é…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥ ä½¿ç”¨é›ªèŠ±ç®—æ³•
        keyGenerators:
          snowflake:
            type: SNOWFLAKE
        props:
          #ã€€æ˜¯å¦æ˜¾ç¤ºsql
          sql-show: true
```

æ ¹æ®ä¸Šé¢çš„é…ç½®æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºæ¥ã€‚idçš„å°¾æ•°åªæœ‰å¯èƒ½æ˜¯å¶æ•°æˆ–å¥‡æ•°ï¼Œå¶æ•°çš„è¯ï¼Œåˆ†åº“ç®—æ³•æ¨¡å‡ºæ¥çš„å°±æ˜¯0ä¹Ÿå°±æ˜¯ds0æ•°æ®æºï¼ŒåŒç†ï¼Œåˆ†è¡¨ç®—æ³•æ¨¡å‡ºæ¥çš„æ˜¯0+1ä¹Ÿå°±æ˜¯user01è¡¨ï¼Œé‚£ä¹ˆåä¹‹ï¼Œå¥‡æ•°å¯¹åº”çš„æ˜¯ds1æ•°æ®æºçš„user02è¡¨ã€‚æˆ‘ä»¬è¿˜æ˜¯å…ˆæ’å…¥å‡ æ¡é…ç½®ã€‚

ds0çš„user01è¡¨çš„æ•°æ®ï¼š

![image-20230501133144329](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011331368.png)

ds1çš„user02è¡¨çš„æ•°æ®ï¼š

![image-20230501133227978](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011332011.png)

ç„¶åæˆ‘ä»¬åˆ†åˆ«ç”¨01çš„idå’Œ02çš„idå»æŸ¥è¯¢éƒ½æ˜¯å¯ä»¥æŸ¥å‡ºæ¥çš„ï¼Œè¿™é‡Œæˆ‘å°±ä¸æ”¾å›¾äº†

### å®ç°åŸç†

åŠŸèƒ½ä¸Šå®ç°åæˆ‘ä»¬å°±å¯ä»¥åˆ†æä¸€ä¸‹å®ç°æµç¨‹äº†ã€‚

![img](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202305011448457.jpeg)

è¿™é‡Œæˆ‘å…ˆæŠŠå®˜æ–¹çš„è§£é‡Šæ”¾å‡ºæ¥

> #### SQL è§£æ
>
> åˆ†ä¸ºè¯æ³•è§£æå’Œè¯­æ³•è§£æã€‚ å…ˆé€šè¿‡è¯æ³•è§£æå™¨å°† SQL æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªä¸å¯å†åˆ†çš„å•è¯ã€‚å†ä½¿ç”¨è¯­æ³•è§£æå™¨å¯¹ SQL è¿›è¡Œç†è§£ï¼Œå¹¶æœ€ç»ˆæç‚¼å‡ºè§£æä¸Šä¸‹æ–‡ã€‚ è§£æä¸Šä¸‹æ–‡åŒ…æ‹¬è¡¨ã€é€‰æ‹©é¡¹ã€æ’åºé¡¹ã€åˆ†ç»„é¡¹ã€èšåˆå‡½æ•°ã€åˆ†é¡µä¿¡æ¯ã€æŸ¥è¯¢æ¡ä»¶ä»¥åŠå¯èƒ½éœ€è¦ä¿®æ”¹çš„å ä½ç¬¦çš„æ ‡è®°ã€‚
>
> #### SQL è·¯ç”±
>
> æ ¹æ®è§£æä¸Šä¸‹æ–‡åŒ¹é…ç”¨æˆ·é…ç½®çš„åˆ†ç‰‡ç­–ç•¥ï¼Œå¹¶ç”Ÿæˆè·¯ç”±è·¯å¾„ã€‚ç›®å‰æ”¯æŒåˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ã€‚
>
> #### SQL æ”¹å†™
>
> å°† SQL æ”¹å†™ä¸ºåœ¨çœŸå®æ•°æ®åº“ä¸­å¯ä»¥æ­£ç¡®æ‰§è¡Œçš„è¯­å¥ã€‚SQL æ”¹å†™åˆ†ä¸ºæ­£ç¡®æ€§æ”¹å†™å’Œä¼˜åŒ–æ”¹å†™ã€‚
>
> #### SQL æ‰§è¡Œ
>
> é€šè¿‡å¤šçº¿ç¨‹æ‰§è¡Œå™¨å¼‚æ­¥æ‰§è¡Œã€‚
>
> #### ç»“æœå½’å¹¶
>
> å°†å¤šä¸ªæ‰§è¡Œç»“æœé›†å½’å¹¶ä»¥ä¾¿äºé€šè¿‡ç»Ÿä¸€çš„ JDBC æ¥å£è¾“å‡ºã€‚ç»“æœå½’å¹¶åŒ…æ‹¬æµå¼å½’å¹¶ã€å†…å­˜å½’å¹¶å’Œä½¿ç”¨è£…é¥°è€…æ¨¡å¼çš„è¿½åŠ å½’å¹¶è¿™å‡ ç§æ–¹å¼ã€‚
>
> #### æŸ¥è¯¢ä¼˜åŒ–
>
> ç”± Federation æ‰§è¡Œå¼•æ“ï¼ˆå¼€å‘ä¸­ï¼‰æä¾›æ”¯æŒï¼Œå¯¹å…³è”æŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼ŒåŒæ—¶æ”¯æŒè·¨å¤šä¸ªæ•°æ®åº“å®ä¾‹çš„åˆ†å¸ƒå¼æŸ¥è¯¢ï¼Œå†…éƒ¨ä½¿ç”¨å…³ç³»ä»£æ•°ä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’ï¼Œé€šè¿‡æœ€ä¼˜è®¡åˆ’æŸ¥è¯¢å‡ºç»“æœã€‚

ç»è¿‡æˆ‘è‡ªå·±çš„æ•´ç†æˆ‘æŠŠå®ƒåˆ†ä¸ºäº†4æ­¥

1. å®¢æˆ·ç«¯å‘é€SQLè¯­å¥åˆ°ShardingJDBCã€‚
2. æ•°æ®åº“è·¯ç”±å™¨è§£æSQLè¯­å¥ï¼Œæå–åˆ†ç‰‡é”®ã€‚
3. æ•°æ®åº“è·¯ç”±å™¨é€šè¿‡åˆ†ç‰‡è§„åˆ™ç®¡ç†å™¨è·å–æ•°æ®åº”è¯¥å­˜å‚¨åœ¨å“ªä¸ªæ•°æ®åº“èŠ‚ç‚¹ä¸­ã€‚
4. æ•°æ®åº“ä»£ç†å°†SQLè¯­å¥å‘é€åˆ°ç›¸åº”çš„æ•°æ®åº“èŠ‚ç‚¹ï¼Œå¹¶å°†ç»“æœåˆå¹¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
