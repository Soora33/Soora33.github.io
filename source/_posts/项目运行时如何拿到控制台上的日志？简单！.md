---
title: é¡¹ç›®è¿è¡Œæ—¶å¦‚ä½•æ‹¿åˆ°æ§åˆ¶å°ä¸Šçš„æ—¥å¿—ï¼Ÿç®€å•ï¼
tags:
  - logback
categories:
  - æ•™ç¨‹
top_img: >-
  https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/1018/wallhaven-exox78_3440x1440.png
cover: >-
  https://minaseinori.oss-cn-hongkong.aliyuncs.com/blog/1018/wallhaven-exox78_3440x1440.png
abbrlink: 95dfaf4e
date: 2022-10-22 15:41:51
---

### å‰è¨€

æœ€è¿‘åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œæ€ä¹ˆæ‹¿åˆ°æ§åˆ¶å°åˆšåˆšæ‰“å°çš„æ—¥å¿—ï¼Œæ¥åšä¸€äº›éœ€æ±‚ã€‚ç”šè‡³è·¨æœåŠ¡å¦‚ä½•è·å–åˆ«çš„æœåŠ¡æ§åˆ¶å°æ‰“å°çš„æ—¥å¿—ã€‚è¿™æ¬¡æˆ‘æ¥åˆ†äº«ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ³•ï¼Œä½¿ç”¨ç›®å‰æœ€ä¸ºå¸¸ç”¨çš„logbackã€‚2åˆ†é’Ÿå³å¯æå®š~

### å¯¼å…¥ä¾èµ–

ä¾èµ–åªéœ€è¦å¯¼å…¥2ä¸ªlogbackçš„ä¾èµ–å°±å¯ä»¥ 

```xml
<!--åœ¨logback-coreåŸºç¡€ä¸Šæ‰©å±•çš„ç‰ˆæœ¬-->
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
</dependency>

<!--logbackåŸºç¡€æ¨¡å—-->
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-core</artifactId>
</dependency>
```

### è‡ªå®šä¹‰Appender

æˆ‘ä»¬è¦æ”¶é›†æ§åˆ¶å°çš„æ—¥å¿—ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªAppenderæ¥å®ç°ã€‚ç»§æ‰¿AppenderBaseï¼ŒAppenderBaseæ˜¯Appenderæ¥å£çš„æŠ½è±¡ç±»ã€‚é‡å†™appendæ–¹æ³•ã€‚å‚æ•°ILoggingEventå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚æœ‰çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½åªéœ€è¦è·å–é¡¹ç›®ä¸­çš„æŸä¸€ä¸ªç±»ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•çš„æŸä¸€è¡Œæ—¥å¿—ã€‚è¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥è‡ªå®šä¹‰ï¼Œé€šè¿‡åŒ…åã€æ—¥å¿—ç­‰çº§ã€ç”šè‡³å¯ä»¥ç”¨æ—¥å¿—å¼€å¤´ä¿¡æ¯æ¥è¿›è¡Œæ›´ç»†è‡´åŒ–çš„ç­›é€‰æˆ‘ä»¬æƒ³è¦æ”¶é›†çš„æ—¥å¿—

```java
public class LogAppender extends AppenderBase<ILoggingEvent> {

    private static final Logger logger = LoggerFactory.getLogger(LogAppender.class);

    @Override
    protected void append(ILoggingEvent event) {
        // è·å–åŒ…å
        String loggerName = event.getLoggerName();
        // è·å–æ—¥å¿—ç­‰çº§
        Level level = event.getLevel();
        // è·å–æ—¥å¿—ä¿¡æ¯
        String message = event.getMessage();

        if ("ERROR".equals(level.toString())) {
            logger.info("è¿½è¸ªåˆ°æ—¥å¿—:");
            logger.info("åŒ…å:" + loggerName);
            logger.info("æ—¥å¿—ç­‰çº§:" + level);
            logger.info("æ—¥å¿—ä¿¡æ¯:" + message);
        }

    }
}
```

### logbacké…ç½®

æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åŠ è½½æˆ‘ä»¬åˆšåˆšå†™çš„Appenderã€‚åœ¨logbackä¸­å¼•å…¥æˆ‘ä»¬åˆšåˆšè‡ªå®šä¹‰Appenderï¼Œåœ¨rootä¸­å¼•ç”¨å°±å¯ä»¥ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è·¨æœåŠ¡æ”¶é›†æ§åˆ¶å°æ—¥å¿—å‘¢ï¼ŸåŒç†ï¼Œåœ¨å¯¹åº”æœåŠ¡çš„logbacké…ç½®ä¸­ä¹ŸåŠ è½½æˆ‘ä»¬è‡ªå®šä¹‰çš„Appenderå°±å¯ä»¥äº†

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <contextName>logback</contextName>

    <!-- æ—¥å¿—çš„è¾“å‡ºç›®å½• -->
    <property name="log.path" value="D:/logback" />

    <!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—-->
    <property name="CONSOLE_LOG_PATTERN"
              value="%yellow(%date{yyyy-MM-dd HH:mm:ss}) %highlight([%-5level]) %green(%logger) %msg%n"/>

    <!--æ–‡ä»¶æ—¥å¿—æ ¼å¼-->
    <property name="FILE_LOG_PATTERN"
              value="%date{yyyy-MM-dd HH:mm:ss} [%-5level] %thread %file:%line %logger %msg%n" />

    <!--ç¼–ç -->
    <property name="ENCODING"
              value="UTF-8" />


    <!-- æ§åˆ¶å°æ—¥å¿— -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
            <charset>${ENCODING}</charset>
        </encoder>
    </appender>

    <!-- æ–‡ä»¶æ—¥å¿— -->
    <appender name="FILE" class="ch.qos.logback.core.FileAppender">
        <file>${log.path}/log.log</file>
        <append>true</append>
        <encoder>
            <pattern>${FILE_LOG_PATTERN}</pattern>
            <charset>${ENCODING}</charset>
        </encoder>
    </appender>

    <appender name="ROLLING_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">

        <!--  è¦åŒºåˆ«äºå…¶ä»–çš„appenderä¸­çš„æ–‡ä»¶åå­—  -->
        <file>${log.path}/log-rolling.log</file>
        <encoder>
            <pattern>${FILE_LOG_PATTERN}</pattern>
            <charset>${ENCODING}</charset>
        </encoder>


        <!-- è®¾ç½®æ»šåŠ¨æ—¥å¿—è®°å½•çš„æ»šåŠ¨ç­–ç•¥ -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ -->
            <fileNamePattern>${log.path}/info/log-rolling-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <!--å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æœ€å¤§æ•°é‡-->
            <maxHistory>15</maxHistory>

            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>1KB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
        </rollingPolicy>

    </appender>

    <!--è‡ªå®šä¹‰Appender è¿½è¸ªæ§åˆ¶å°æ—¥å¿—-->
    <appender name="getConsoleLog" class="com.sora.logback.appender.LogAppender"></appender>

    <root level="INFO">
        <appender-ref ref="CONSOLE" />
        <appender-ref ref="FILE" />
        <appender-ref ref="getConsoleLog" />
    </root>
</configuration>

```

### ç»“æœ

è¿™é‡Œæˆ‘è®¾ç½®äº†é¡¹ç›®å¯åŠ¨åæ‰“å°2æ¡æ—¥å¿—ï¼Œåˆ†åˆ«æ˜¯WARNçº§åˆ«å’ŒERRORçº§åˆ«çš„

```java
@Component
public class PrintLog implements ApplicationRunner {

    private static final Logger logger = LoggerFactory.getLogger(PrintLog.class);

    @Override
    public void run(ApplicationArguments args) throws Exception {
        logger.warn("å¯åŠ¨åæ‰“å°INFOæ—¥å¿—!");
        logger.error("å¯åŠ¨åæ‰“å°ERRORæ—¥å¿—!");
    }
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„2æ¡æ—¥å¿—æ­£å¸¸æ‰“å°ï¼Œç„¶åè‡ªå®šä¹‰çš„Appenderç»è¿‡è¿‡æ»¤ï¼Œåªè·å–ERRORçš„æ—¥å¿—ã€‚éœ€æ±‚å®ç°~

![image-20221022160030909](https://minaseinori.oss-cn-hongkong.aliyuncs.com/%E6%95%99%E5%AD%A6%E7%9B%AE%E5%BD%95/202210221600050.png)

æ”¶é›†æ§åˆ¶å°æ—¥å¿—å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œä¸‹æ¬¡è§ğŸ˜
